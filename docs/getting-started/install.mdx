# Install Verilua

æœ¬èŠ‚ä¸»è¦ä»‹ç»å¦‚ä½•å®‰è£… Veriluaã€‚Verilua æ”¯æŒä¸¤ç§å®‰è£…æ–¹å¼ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹å¼ï¼š

| å®‰è£…æ–¹å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ |
|---------|---------|------|
| **Release å®‰è£…ï¼ˆæ¨èï¼‰** | æ™®é€šç”¨æˆ·ï¼Œå¿«é€Ÿä¸Šæ‰‹ä½¿ç”¨ | æ— éœ€ç¼–è¯‘ï¼Œå³ä¸‹å³ç”¨ |
| **æºç å®‰è£…** | å¼€å‘è€…ï¼Œéœ€è¦è‡ªå®šä¹‰æˆ–å‚ä¸è´¡çŒ® | å¯ä¿®æ”¹æºç ï¼Œè·å¾—æœ€æ–°ç‰¹æ€§ |

---

## æ–¹å¼ä¸€ï¼šä½¿ç”¨ Release å®‰è£…ï¼ˆæ¨èï¼‰

è¿™æ˜¯æœ€ç®€å•çš„å®‰è£…æ–¹å¼ï¼Œç›´æ¥ä¸‹è½½é¢„ç¼–è¯‘çš„ Release åŒ…å³å¯ä½¿ç”¨ã€‚

### 1. ä¸‹è½½ Release åŒ…

#### æ–¹æ³• Aï¼šä» GitHub Releases ä¸‹è½½ï¼ˆç¨³å®šç‰ˆï¼‰

è®¿é—® [GitHub Releases é¡µé¢](https://github.com/cyril0124/verilua/releases)ï¼Œé€‰æ‹©é€‚åˆæ‚¨æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬ä¸‹è½½ã€‚ä¾‹å¦‚ï¼š

- `verilua-x64-ubuntu-22.04.zip` (Ubuntu 22.04)
- `verilua-x64-centos-7.zip` (CentOS 7)

```bash
# ä»¥ Ubuntu 22.04 ä¸ºä¾‹
wget https://github.com/cyril0124/verilua/releases/download/v2.0.0/verilua-x64-ubuntu-22.04.zip
unzip verilua-x64-ubuntu-22.04.zip
```

#### æ–¹æ³• Bï¼šä» GitHub Actions è·å–æœ€æ–°å¼€å‘ç‰ˆï¼ˆå°é²œï¼‰

å¦‚æœæ‚¨æƒ³ä½“éªŒæœ€æ–°åŠŸèƒ½ï¼ˆå¯èƒ½å°šæœªæ­£å¼å‘å¸ƒï¼‰ï¼Œå¯ä»¥ä» CI æ„å»ºçš„ artifacts ä¸­è·å–ï¼š

1. æ‰“å¼€ [Actions é¡µé¢](https://github.com/cyril0124/verilua/actions/workflows/regression.yml)
2. é€‰æ‹©æœ€è¿‘ä¸€æ¬¡æˆåŠŸè¿è¡Œçš„ **Regression** å·¥ä½œæµ
3. ä¸‹è½½å¯¹åº”å¹³å°çš„ artifactï¼ˆä¾‹å¦‚ `verilua-x64-ubuntu-22.04-xxxxxxx`ï¼‰

> ğŸ’¡ **æç¤º**ï¼šè¿™äº›åŒ…åŸºäºæœ€æ–°ä»£ç æ„å»ºï¼ŒåŒ…å«æœ€æ–°çš„åŠŸèƒ½å’Œä¿®å¤ã€‚è‹¥æ²¡æœ‰é€‚åˆæ‚¨ç³»ç»Ÿçš„åŒ…ï¼Œå¯å°è¯•ä½¿ç”¨ CentOS 7 çš„åŒ…ï¼ˆåŸºäº glibc 2.17ï¼Œé€šå¸¸å…¼å®¹æ›´é«˜ç‰ˆæœ¬ç³»ç»Ÿï¼‰ã€‚

### 2. è§£å‹å¹¶æ¿€æ´»ç¯å¢ƒ

```bash
cd verilua-x64-ubuntu-22.04       # è¿›å…¥è§£å‹åçš„ç›®å½•
source verilua.sh                  # æ¿€æ´» Verilua ç¯å¢ƒ
```

æ¿€æ´»åï¼Œæ‚¨å°†å¯ä»¥åœ¨å½“å‰ shell ä¸­ä½¿ç”¨ Verilua æä¾›çš„å‘½ä»¤ï¼ˆå¦‚ `test_verilua`ã€`xmake` ç­‰ï¼‰ã€‚

### 3. éªŒè¯å®‰è£…

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æµ‹è¯• Verilua æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š

```bash
test_verilua
```

å¦‚æœå®‰è£…æˆåŠŸï¼Œæ‚¨å°†çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºï¼š

```text
Test Results:
  âœ“ Passed: 2
  âœ— Failed: 0

âœ“  All verilua tests passed!
```

---

## æ–¹å¼äºŒï¼šä»æºç å®‰è£…

é€‚ç”¨äºéœ€è¦è‡ªå®šä¹‰ç¼–è¯‘æˆ–å‚ä¸å¼€å‘çš„ç”¨æˆ·ã€‚è¯·ç¡®ä¿ç½‘ç»œç¯å¢ƒè‰¯å¥½ï¼Œä»¥ä¾¿ä¸‹è½½ä¾èµ–ã€‚

### å‰ææ¡ä»¶

#### åŸºç¡€å·¥å…·é“¾

- **gcc >= 11.0**ï¼ˆéœ€æ”¯æŒ C++20ï¼‰
- **xmake**ï¼šå®‰è£…å‚è€ƒ [xmake å®˜æ–¹æ–‡æ¡£](https://xmake.io/#/guide/installation)
- **Rust**ï¼šå®‰è£…å‚è€ƒ [rustup](https://rustup.rs/)
- **Python 3.x**ï¼ˆæŸäº›è„šæœ¬ä¾èµ–ï¼‰

#### ç¡¬ä»¶ä»¿çœŸå™¨ï¼ˆè‡³å°‘é€‰æ‹©ä¸€ä¸ªï¼‰

æ ¹æ®æ‚¨çš„éœ€æ±‚å®‰è£…ä»¥ä¸‹ä»¿çœŸå™¨ä¹‹ä¸€ï¼š

- **[Verilator](https://github.com/verilator/verilator) >= 5.026**
- **[Icarus Verilog](https://github.com/steveicarus/iverilog)**ï¼ˆæ³¨æ„ç‰ˆæœ¬é—®é¢˜ï¼Œè§ä¸‹æ–‡ï¼‰
- **Synopsys VCS**ï¼ˆå•†ä¸šè½¯ä»¶ï¼‰
- **Cadence Xcelium**ï¼ˆå•†ä¸šè½¯ä»¶ï¼‰

##### âš ï¸ Icarus Verilog ç‰ˆæœ¬æ³¨æ„äº‹é¡¹

iverilog çš„ v12_0 ç‰ˆæœ¬å­˜åœ¨ [cbNextSimTime æ— é™å¾ªç¯é—®é¢˜](https://github.com/steveicarus/iverilog/pull/1098)ï¼Œä¼šå½±å“ Verilua çš„å¤šä»»åŠ¡è°ƒåº¦ã€‚**è¯·ä½¿ç”¨ master åˆ†æ”¯ï¼ˆv13-develï¼‰æˆ– `s20250103` æ ‡ç­¾**ã€‚

```bash
git clone https://github.com/steveicarus/iverilog.git
cd iverilog
git checkout s20250103                # æˆ–ä½¿ç”¨ master åˆ†æ”¯
sh autoconf.sh
./configure
make
sudo make install
```

å®‰è£…åï¼Œè®¾ç½®ç¯å¢ƒå˜é‡ `IVERILOG_HOME` æŒ‡å‘å®‰è£…ç›®å½•ï¼ˆåŒ…å« `bin` å’Œ `lib` çš„ç›®å½•ï¼‰ï¼š

```bash
export IVERILOG_HOME=/path/to/iverilog   # æ·»åŠ åˆ° shell é…ç½®æ–‡ä»¶
```

### å®‰è£…æ­¥éª¤

1. **å…‹éš† Verilua ä»“åº“**ï¼ˆå¦‚æœå°šæœªä¸‹è½½æºç ï¼‰

   ```bash
   git clone --recursive https://github.com/cyril0124/verilua.git
   cd verilua
   ```

2. **æ‰§è¡Œå®‰è£…å‘½ä»¤**

   ```bash
   xmake install verilua
   ```

   è¯¥å‘½ä»¤ä¼šè‡ªåŠ¨å®‰è£…æ‰€æœ‰ä¾èµ–ã€ç¼–è¯‘å·¥å…·å¹¶é…ç½®ç¯å¢ƒã€‚

3. **ï¼ˆå¯é€‰ï¼‰å¦‚æœå®‰è£…å¤±è´¥**ï¼Œå¯ä»¥é‡æ–°æ‰§è¡Œä¸Šè¿°å‘½ä»¤ï¼Œç½‘ç»œé—®é¢˜æˆ–ä¸´æ—¶é”™è¯¯å¯èƒ½ä¼šè¢«è§£å†³ã€‚

### éªŒè¯å®‰è£…

- æ£€æŸ¥ç¯å¢ƒå˜é‡ `VERILUA_HOME` æ˜¯å¦æŒ‡å‘ Verilua æºç ç›®å½•ï¼š

  ```bash
  echo $VERILUA_HOME
  ```

- è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ï¼š

  ```bash
  xmake run test
  ```

  æˆåŠŸæ—¶æ‚¨å°†çœ‹åˆ° Verilua çš„ ASCII è‰ºæœ¯ Logoï¼š

  ```text
    _____         _____ _____ 
   |  __ \ /\    / ____/ ____|
   | |__) /  \  | (___| (___  
   |  ___/ /\ \  \___ \\___ \ 
   | |  / ____ \ ____) |___) |
   |_| /_/    \_\_____/_____/ 
  ```

---

## å¸¸è§é—®é¢˜

### Q1ï¼šå®‰è£…å `test_verilua` å‘½ä»¤æ‰¾ä¸åˆ°ï¼Ÿ

- **åŸå› **ï¼šæœªæ­£ç¡®æ¿€æ´»ç¯å¢ƒï¼Œæˆ– `verilua.sh` æœªè¢« sourceã€‚
- **è§£å†³**ï¼šç¡®ä¿è¿›å…¥è§£å‹ç›®å½•å¹¶æ‰§è¡Œ `source verilua.sh`ã€‚

### Q2ï¼šæºç å®‰è£…æ—¶ `xmake install verilua` å¤±è´¥ï¼Œæç¤ºç¼ºå°‘ä¾èµ–ï¼Ÿ

- **è§£å†³**ï¼šæ‰‹åŠ¨å®‰è£…ç¼ºå¤±çš„ä¾èµ–ï¼ˆå¦‚ gccã€rust ç­‰ï¼‰ï¼Œç„¶åé‡è¯•ã€‚å¦‚æœç½‘ç»œé—®é¢˜å¯¼è‡´ä¸‹è½½å¤±è´¥ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ä»£ç†æˆ–é‡æ–°è¿è¡Œã€‚

### Q3ï¼šå¦‚ä½•åˆ‡æ¢ Verilua ç‰ˆæœ¬ï¼Ÿ

- **Release å®‰è£…**ï¼šé‡æ–°ä¸‹è½½æ–°ç‰ˆæœ¬åŒ…ï¼Œè§£å‹å¹¶é‡æ–° sourceã€‚
- **æºç å®‰è£…**ï¼š`git pull` æ‹‰å–æœ€æ–°ä»£ç ï¼Œç„¶åå†æ¬¡è¿è¡Œ `xmake install verilua`ã€‚

### Q4ï¼šiverilog å®‰è£…å Verilua ä»æŠ¥ç‰ˆæœ¬é”™è¯¯ï¼Ÿ

- **ç¡®è®¤** `iverilog -V` æ˜¾ç¤ºçš„ç‰ˆæœ¬æ˜¯å¦ä¸ºæ­£ç¡®çš„ commit æˆ– tagã€‚ç¡®ä¿ `IVERILOG_HOME` è®¾ç½®æ­£ç¡®ã€‚

---

## æ¨èçš„ Lua å¼€å‘æ’ä»¶

ä¸ºè·å¾—æ›´å¥½çš„ä»£ç è¡¥å…¨ã€è·³è½¬å’Œç±»å‹æ ‡æ³¨ä½“éªŒï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä»¥ä¸‹æ’ä»¶ä¹‹ä¸€ï¼ˆæ›´æ¨èä½¿ç”¨ EmmyLuaLsï¼‰ï¼š

- **[lua-language-server](https://github.com/LuaLS/lua-language-server)**ï¼ˆVS Code æ’ä»¶ï¼šLuaï¼‰
- **[EmmyLuaLs](https://github.com/EmmyLuaLs/emmylua-analyzer-rust)**ï¼ˆæ”¯æŒ EmmyLua æ³¨è§£ï¼‰

### é…ç½® EmmyLuaLs

EmmyLuaLs éœ€è¦ä¸€ä¸ª `.emmyrc.json` é…ç½®æ–‡ä»¶æ”¾ç½®åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆæˆ–å·¥ä½œåŒºï¼‰ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºè¯¥æ–‡ä»¶ï¼Œä¸€ä¸ªæœ€å°é…ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼š

```json
{
  "$schema": "https://raw.githubusercontent.com/EmmyLuaLs/emmylua-analyzer-rust/refs/heads/main/crates/emmylua_code_analysis/resources/schema.json",
  "runtime": {
    "version": "LuaJIT"
  },
  "hint.enable": true,
  "workspace": {
    "library": [
      "$VERILUA_HOME/src/lua",
      "$VERILUA_HOME/src/lua/verilua"
    ]
  }
}
```

**è¯´æ˜**ï¼š
- `$VERILUA_HOME` ä¼šè¢«è‡ªåŠ¨æ›¿æ¢ä¸º Verilua çš„å®‰è£…è·¯å¾„ï¼Œå‰ææ˜¯è¯¥ç¯å¢ƒå˜é‡å·²åœ¨ shell ä¸­è®¾ç½®ã€‚
- è¯¥é…ç½®ä»…åŒ…å«è¯†åˆ« Verilua åº“çš„å¿…è¦é¡¹ï¼Œå®Œæ•´çš„åŠŸèƒ½é…ç½®è¯·å‚è€ƒ [EmmyLuaLs å®˜æ–¹æ–‡æ¡£](https://emmylualangs.github.io/)ã€‚

