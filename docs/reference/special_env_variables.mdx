# 特殊环境变量

Verilua 支持通过环境变量来控制其行为和配置。所有环境变量都是可选的，如果不设置，Verilua 会使用合理的默认值。环境变量可以通过配置文件设置，也可以直接在 shell 中设置。

## 核心环境变量

### SIM (可选，需谨慎使用)

指定使用的仿真器类型。

**默认值**：自动检测（通过 vpiml）

**可选值**：
- `verilator` - Verilator 仿真器
- `vcs` - Synopsys VCS 仿真器
- `xcelium` - Cadence Xcelium 仿真器
- `iverilog` - Icarus Verilog 仿真器
- `wave_vpi` - Verilua 波形分析后端（WAL 模式）

**优先级**：`cfg.simulator` 配置文件 > `SIM` 环境变量 > 自动检测

**重要提示**：**SIM 环境变量应该与编译时使用的仿真器保持一致**。如果两者不一致，可能会导致运行时错误或不可预期的行为。如果不清楚编译时使用的仿真器，建议让 Verilua 自动检测或通过配置文件设置。

**相关配置影响**：
- 设置 `cfg.simulator` 值
- 当值为 `wave_vpi` 时，自动设置 `cfg.is_wal = true`
- 当值为其他仿真器时，如果设置 `cfg.is_hse = true`，则为 HSE 模式
- `cfg.is_hse` 和 `cfg.is_wal` 不能同时为 true

**示例**：

```bash
SIM=vcs xmake r -P .
SIM=verilator xmake b -P . && xmake r -P .
```

---

### DUT_TOP (可选)

指定设计的顶层模块名称。

**默认值**：通过 VPI 接口自动获取

**对应 cfg 字段**：`cfg.top`

**自动获取方式**：当未设置时，Verilua 会通过 vpiml 使用 VPI 接口遍历当前设计中的模块，获取第一个模块的名称作为顶层模块。

**示例**：

```bash
export DUT_TOP=tb_top
```

---

### PRJ_DIR (可选)

指定项目根目录。

**默认值**：`.`（当前目录）

**对应 cfg 字段**：`cfg.prj_dir`

**示例**：

```bash
export PRJ_DIR=/path/to/project
```

---

### SEED (可选)

设置仿真随机种子。

**默认值**：`1234`

**对应 cfg 字段**：`cfg.seed`

**优先级说明**：环境变量 `SEED` 的优先级高于配置文件中的 `cfg.seed`，如果设置了环境变量会覆盖配置文件的值。

**示例**：

```bash
export SEED=42
```

---

## 调试和日志变量

### VL_DEBUG (可选)

启用 Verilua debug 输出。

**默认值**：未启用

**使用效果**：启用后会输出 `verilua_debug()` 调试信息

**示例**：

```bash
export VL_DEBUG=1
```

**性能影响**：未设置时零开销

---

### VL_QUIET (可选)

静默模式，禁用所有日志输出。

**默认值**：未启用（正常输出日志）

**影响范围**：当启用时，以下输出会被禁用：
- Logger 模块的所有日志输出：
  - `info()` 方法
  - `debug()` 方法
  - `warning()` 方法
  - `error()` 方法
  - `success()` 方法
- 仿真结束时 Rust 层输出的统计信息表格（VERILUA STATISTIC），包含：
  - `total_time_taken` - 总耗时
  - `lua_time_taken` - Lua 执行耗时
  - `lua_overhead` - Lua 开销百分比

**注意**：VL_QUIET 仅影响 Verilua 框架内部的 Logger 模块输出，不会影响用户代码中的 `print()` 函数调用。这是因为 Logger 模块使用的是局部的 `print` 变量，而用户代码使用的是全局的 `print` 函数。

**示例**：

```bash
export VL_QUIET=1
```

---

### VL_PERF_TIME (可选)

启用性能时间统计。

**默认值**：未启用

**示例**：

```bash
export VL_PERF_TIME=1
```

---

## 相关文档

- [全局配置信息](./global_configuration.mdx)
- [仿真器控制](./simulator_control.mdx)
- [xmake 参数说明](./xmake_params.mdx)
