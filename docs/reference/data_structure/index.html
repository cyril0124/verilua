<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-reference/data_structure" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">数据结构 | Verilua</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://cyril0124.github.io/verilua/img/verilua-social-card.png"><meta data-rh="true" name="twitter:image" content="https://cyril0124.github.io/verilua/img/verilua-social-card.png"><meta data-rh="true" property="og:url" content="https://cyril0124.github.io/verilua/docs/reference/data_structure"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="数据结构 | Verilua"><meta data-rh="true" name="description" content="在 Verilua 中，硬件信号通常被建模为 Handle，这也是 Verilua 中数据结构的主要命名方式。Handle 有多种类型："><meta data-rh="true" property="og:description" content="在 Verilua 中，硬件信号通常被建模为 Handle，这也是 Verilua 中数据结构的主要命名方式。Handle 有多种类型："><link data-rh="true" rel="icon" href="/verilua/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://cyril0124.github.io/verilua/docs/reference/data_structure"><link data-rh="true" rel="alternate" href="https://cyril0124.github.io/verilua/docs/reference/data_structure" hreflang="en"><link data-rh="true" rel="alternate" href="https://cyril0124.github.io/verilua/docs/reference/data_structure" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"数据结构","item":"https://cyril0124.github.io/verilua/docs/reference/data_structure"}]}</script><link rel="stylesheet" href="/verilua/assets/css/styles.b7591dbf.css">
<script src="/verilua/assets/js/runtime~main.d3a82bc7.js" defer="defer"></script>
<script src="/verilua/assets/js/main.7166b913.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/verilua/img/logo.svg"><link rel="preload" as="image" href="/verilua/assets/images/verilua_dsl_datastructure-c0cffc9401af486d600b391318b546f9.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/verilua/"><div class="navbar__logo"><img src="/verilua/img/logo.svg" alt="Verilua Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/verilua/img/logo.svg" alt="Verilua Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Verilua</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/verilua/docs/">Documentation</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/cyril0124/verilua" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/verilua/docs/"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/verilua/docs/getting-started/install"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/verilua/docs/getting-started/install"><span title="Install Verilua" class="linkLabel_WmDU">Install Verilua</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/verilua/docs/getting-started/simple_hvl_example"><span title="一个简单的 HVL 示例" class="linkLabel_WmDU">一个简单的 HVL 示例</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/verilua/docs/getting-started/simple_hse_example"><span title="一个简单的 HSE 示例" class="linkLabel_WmDU">一个简单的 HSE 示例</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/verilua/docs/getting-started/simple_wal_example"><span title="一个简单的 WAL 示例" class="linkLabel_WmDU">一个简单的 WAL 示例</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/verilua/docs/how-to-guides/simple_ut_env"><span title="How-to Guides" class="categoryLinkLabel_W154">How-to Guides</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/verilua/docs/how-to-guides/simple_ut_env"><span title="搭建一个简单的 UT 环境" class="linkLabel_WmDU">搭建一个简单的 UT 环境</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/verilua/docs/how-to-guides/write_reusable_component"><span title="编写可复用的验证组件" class="linkLabel_WmDU">编写可复用的验证组件</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/verilua/docs/reference/multi_task"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/verilua/docs/reference/multi_task"><span title="多任务系统" class="linkLabel_WmDU">多任务系统</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/verilua/docs/reference/data_structure"><span title="数据结构" class="linkLabel_WmDU">数据结构</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/verilua/docs/reference/bitvec"><span title="BitVec" class="linkLabel_WmDU">BitVec</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/verilua/docs/reference/slcp"><span title="String Literal Constructor Pattern (SLCP)" class="linkLabel_WmDU">String Literal Constructor Pattern (SLCP)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/verilua/docs/reference/simulator_control"><span title="仿真器控制" class="linkLabel_WmDU">仿真器控制</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/verilua/docs/reference/testbench_generate"><span title="Testbench 自动生成流程" class="linkLabel_WmDU">Testbench 自动生成流程</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/verilua/docs/reference/xmake_params"><span title="xmake 的配置参数" class="linkLabel_WmDU">xmake 的配置参数</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/verilua/docs/reference/global_configuration"><span title="全局配置信息" class="linkLabel_WmDU">全局配置信息</span></a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/verilua/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Reference</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">数据结构</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>数据结构</h1></header>
<p>在 <code>Verilua</code> 中，硬件信号通常被建模为 <code>Handle</code>，这也是 <code>Verilua</code> 中数据结构的主要命名方式。<code>Handle</code> 有多种类型：</p>
<ol>
<li class="">
<p>CallableHDL(<code>chdl</code>)</p>
<p>与信号进行操作的一个底层数据结构，提供了信号赋值和读取等接口，其中还包括了各种硬件信号相关的 Meta 信息，例如 width、hierarchy path。</p>
</li>
<li class="">
<p>Bundle(<code>bdl</code>)</p>
<p>一种将多个信号封装在一起的数据结构，参考了 <code>Chisel</code> 的概念，因此支持 Decoupled 和 Valid 等子类型，能够统一管理多个 <code>chdl</code>。</p>
</li>
<li class="">
<p>AliasBundle(<code>abdl</code>)</p>
<p>一种特殊的 <code>bdl</code>，允许用户为信号组中的部分信号提供<strong>别名</strong>，从而提高代码可读性，同时仍支持对底层 <code>chdl</code> 的直接访问。</p>
</li>
<li class="">
<p>ProxyTableHandle(<code>dut</code>)</p>
<p>通过全局 ProxyTable 智能解析路径（hierarchy path），支持与 <code>chdl</code> 几乎相同的信号操作接口，用户可直接访问信号，无需显式构造 <code>chdl</code> 或 <code>bdl</code>，简化访问复杂性，提升代码灵活性和可维护性。但是这种访问方式的设计之初主要是为了快速的临时访问信号，因此性能是不如 <code>chdl</code> 的。</p>
</li>
<li class="">
<p>EventHandle(<code>ehdl</code>)</p>
<p>用于任务同步与通信，通过事件机制实现任务间的协调，用户可创建不同 <code>ehdl</code> 来同步任务执行顺序。需要注意的是，Event Handle 并非用于直接操作信号，而是用于管理任务之间的同步与通信，确保任务按预期顺序执行。</p>
</li>
</ol>
<figure><img src="/verilua/assets/images/verilua_dsl_datastructure-c0cffc9401af486d600b391318b546f9.png" alt="Verilua data structure" style="width:100%"><figcaption>Verilua data structure</figcaption></figure>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="callablehdl">CallableHDL<a href="#callablehdl" class="hash-link" aria-label="Direct link to CallableHDL" title="Direct link to CallableHDL" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="创建-callablehdl">创建 CallableHDL<a href="#创建-callablehdl" class="hash-link" aria-label="Direct link to 创建 CallableHDL" title="Direct link to 创建 CallableHDL" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="使用-dut-创建推荐">使用 dut 创建（推荐）<a href="#使用-dut-创建推荐" class="hash-link" aria-label="Direct link to 使用 dut 创建（推荐）" title="Direct link to 使用 dut 创建（推荐）" translate="no">​</a></h4>
<p>使用 <code>dut</code> 来创建 <code>chdl</code> 需要完整的使用 <code>dut</code> 表示出一个信号的 hierarchy path（这里的 <code>dut</code> 表示的是 Testbench 的模块名称，默认是 <code>tb_top</code>），例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>通常对于一些 DUT 的<strong>顶层信号</strong>，可以使用 <code>dut.xxx</code> 表示，例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>对于 DUT 的内部信号，可以使用 <code>dut.u_&lt;top_module_name&gt;.&lt;internal_signal_name&gt;</code> 表示，具体原因可以查看<a class="" href="/verilua/docs/getting-started/simple_hvl_example#about-dut">此处的说明</a>，代码例子如下：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">u_Design</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div id="dut-flex_create_chdl"></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>基于 <code>dut</code> 灵活创建 <code>chdl</code></div><div class="admonitionContent_BuS1"><p>Lua 中，可以使用 string 来灵活访问某个 table 的子变量，例如：</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> a1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> aa </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;a0&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bb </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;b0&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> aa</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> bb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">..</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">a0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">..</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">a1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre></div></div><p>可以看到利用字符串拼接等方法访问一些有规律的子变量，这提供了更灵活的方式来访问子变量。</p><p>而 <code>dut</code> 本质上也是一个 table，因此也可以使用 string 来访问 <code>dut</code> 的子变量，例如：</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signals</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;some_module_&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">..</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre></div></div><p>上面这个例子中我们使用 for 循环批量获得了 5 个 <code>chdl</code> 对象，这些对象分别对应 dut 中 some_module_1 到 some_module_5 这五个有规律的模块的 value 字段，并将其放入了一个 table 中。同样地，对于信号名也可以这么操作：</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    table</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signals</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;some_value_&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">..</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre></div></div></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="使用-class-创建">使用 class 创建<a href="#使用-class-创建" class="hash-link" aria-label="Direct link to 使用 class 创建" title="Direct link to 使用 class 创建" translate="no">​</a></h4>
<p>本质上 <code>CallableHDL</code> 是一个 class，因此可以使用类似 <code>class</code> 的方式创建，例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> CallableHDL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> require </span><span class="token string" style="color:#e3116c">&quot;LuaCallableHDL&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> chdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">CallableHDL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;name of the chdl&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tb_top.clock&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- equivalent to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> chdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><code>CallableHDL</code> 接收两个参数，第一个是 <code>chdl</code> 的名称，第二个则是信号的完整 hierarchy path。</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="使用-string-literal-创建推荐">使用 string literal 创建（推荐）<a href="#使用-string-literal-创建推荐" class="hash-link" aria-label="Direct link to 使用 string literal 创建（推荐）" title="Direct link to 使用 string literal 创建（推荐）" translate="no">​</a></h4>
<p>Lua 的允许重载 string 的 <code>metatable</code>，Verilua 基于这个机制实现了一种简化的方式来创建 <code>chdl</code>, 例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> chdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;tb_top.clock&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div id="slcp-explain"></div>
<p>这种方式在 Verilua 中被称为 <strong>S</strong>tring <strong>L</strong>iteral <strong>C</strong>onstructor <strong>P</strong>attern（SLCP），使用 SLCP 的好处在于可以不用像 <code>class</code> 构建那样提前使用 <code>require</code> 将 <code>LuaCallableHDL</code> 加载代码中，而是在使用时根据后缀的方法名（<code>:chdl()</code>）来直接创建 <code>chdl</code>。 除了 <code>chdl</code> 之外，其他的数据结构同样也支持使用 SLCP 的方式来创建。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="callablehdl-接口">CallableHDL 接口<a href="#callablehdl-接口" class="hash-link" aria-label="Direct link to CallableHDL 接口" title="Direct link to CallableHDL 接口" translate="no">​</a></h3>
<p><code>CallableHDL</code> 支持多种信号操作接口，且相关接口函数的功能会与具体信号的位宽有关，因此在使用时需要注意一些细节。</p>
<p>Verilua 中根据信号的位宽不同，隐式地将 <code>chdl</code> 分为了三种类型：</p>
<ol>
<li class="">Single：位宽 &lt;= 32 bit 的信号</li>
<li class="">Double：位宽 &gt; 32 bit 且 &lt;= 64 bit 的信号</li>
<li class="">Multi：位宽 &gt; 64 bit 的信号</li>
</ol>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>在后续的 API 介绍的内容中，如果没有特别写出针对这三种情况的说明，那么默认情况下相关 API 的行为都是一致的</div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>之所以会有区分是为了尽可能针位宽实施更多性能上的优化</div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span><code>beat</code> 的概念</div><div class="admonitionContent_BuS1"><p>硬件信号的位宽是没有限制的，但是在 Lua 中普通的 number 类型能够保存 32 bit 的数值，因此 Verilua 以 32 bit 为单位来表示一部分的信号的值，这个单位称为 <code>beat</code>。例如：1 ～ 32 bit 的信号可以用 1 个 beat 来表示，33 ～ 64 bit 的信号可以用 2 个 beat 来表示，以此类推。beat 的概念在后续的 API 介绍中会经常遇到。</p><p>可以使用 <code>&lt;chdl&gt;.beat_num</code> 来获得 beat 数。</p></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="信号读取">信号读取<a href="#信号读取" class="hash-link" aria-label="Direct link to 信号读取" title="Direct link to 信号读取" translate="no">​</a></h4>
<ol>
<li class="">
<p><code>&lt;chdl&gt;:get()</code></p>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Single</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Double</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Multi</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>返回一个 Lua 的 number 类型的数值，表示当前的信号值。</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><code>&lt;chdl&gt;:get(force_multi_beat)</code></p><ul>
<li class="">
<p>如果 <code>force_multi_beat</code> 为 <code>true</code>，那么返回的是一个类型为 <code>uint32_t[]</code> 的 LuaJIT <code>cdata</code>，这个 <code>cdata</code> 的大小为 2，可以使用 <code>[1]</code> 访问第一个元素，<code>[2]</code> 访问第二个元素，由于 <code>cdata</code> 不是 Lua 的 <code>table</code> 因此实际上 <code>[0]</code> 也是可以访问的，但是这里 Verilua 会将 <code>[0]</code> 赋值为 beat 的大小，也就是这里的 2。</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>这里的 <code>cdata</code> 的 index 从 1 开始，这与 Lua 的 <code>table</code> 的 index 是一样的</div></div>
</li>
<li class="">
<p>如果 <code>force_multi_beat</code> 为 <code>false</code>，那么返回的是 <code>uint64_t</code> 类型的数值，由于 Double 类型的 <code>chdl</code> 的位宽为 32 ～ 64 bit，因此可以完整表达当前的数值。</p>
</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>返回的是一个类型为 <code>uint32_t[]</code> 的 LuaJIT <code>cdata</code>，这个 <code>cdata</code> 的大小为当前信号的 beat 数，可以使用 <code>[1]</code> 访问第一个元素，<code>[2]</code> 访问第二个元素，以此类推， <code>[0]</code> 也是可以访问的，但是这里 Verilua 会将 <code>[0]</code> 赋值为 beat 的大小，例如对于 128 bit 的信号，<code>[0]</code> 会被赋值为 4。</p></div></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:get64()</code></p>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Single</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Double / Multi</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>返回一个 Lua 的 number 类型的数值，表示当前的信号值。</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>返回 <code>uint64_t</code> 类型的数值，由于 Double 类型的 <code>chdl</code> 的位宽为 32 ～ 64 bit，因此可以完整表达当前的数值，但是对于 Multi 类型的 <code>chdl</code>，此时 beat 大于 2，因此返回的 <code>uint64_t</code> 类型的数值不能完整表示当前的信号值，只会返回低 64 bit 的值。</p></div></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:get_bitvec()</code></p>
<p>返回一个 <code>BitVec</code>，关于 <code>BitVec</code> 可以查看 <a class="" href="/verilua/docs/reference/bitvec">BitVec</a> 的文档。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:get_str(fmt)</code></p>
<div id="chdl-get_str"></div>
<p>获得当前信号的数值，并以 String 的类型返回，接受一个 <code>fmt</code> 参数，用于指定返回的字符串的格式，可以是 <code>HexStr</code>、<code>BinStr</code>、<code>DecStr</code>。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> value_hex_str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">HexStr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value_hex_str </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> value_bin_str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BinStr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value_bin_str </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;100100011&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> value_dec_str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">DecStr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value_dec_str </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;291&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>这里的 <code>HexStr</code>、<code>BinStr</code>、<code>DecStr</code> 是 Verilua 预定义的全局变量，可以直接使用</div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:get_hex_str()</code></p>
<div id="chdl-get_hex_str"></div>
<p>获得当前信号的数值，并以 Hex String 的类型返回。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> value_hex_str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_hex_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value_hex_str </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:get_dec_str()</code></p>
<p>类似 <code>get_hex_str</code>，但是返回的是 Decimal String 类型的字符串。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:get_bin_str()</code></p>
<p>类似 <code>get_hex_str</code>，但是返回的是 Binary String 类型的字符串。</p>
</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="信号赋值">信号赋值<a href="#信号赋值" class="hash-link" aria-label="Direct link to 信号赋值" title="Direct link to 信号赋值" translate="no">​</a></h4>
<ol>
<li class="">
<p><code>&lt;chdl&gt;:set(value)</code></p>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Single</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Double / Multi</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>将 <code>value</code> 赋值给当前信号。</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><code>&lt;chdl&gt;:set(value, force_single_beat)</code></p><ul>
<li class="">
<p>如果 <code>force_single_beat</code> 为 <code>nil</code>（也就是不传入这个参数），那么此时的 <code>value</code> 必须是一个 Lua number 类型的 table，并且这个 table 的大小需要和信号的 beat 数相同，否则会报错。这个 table 的数值以 <code>&lt;LSB&gt; ~ &lt;MSB&gt;</code> 的顺序排列。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x456</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>如果 <code>force_single_beat</code> 为 <code>true</code>，那么此时的 <code>value</code> 可以是一个 Lua number 类型的数值，此时只能赋值信号的低 32 bit，如果 <code>value</code> 是一个 <code>uint64_t</code> 的 <code>cdata</code>，那么此时就能赋值信号的低 64 bit（对于 Double 类型的 <code>chdl</code> 也就是能覆盖整个信号的位宽），且高于 64 bit 的位置将会被赋值为 0。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> value64 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 0x1234567890ABCDEFULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">true</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>LuaJIT 中对一串数字添加上 <code>ULL</code> 的后缀就可以表示一个 <code>uint64_t</code> 类型的 <code>cdata</code></div></div>
</li>
</ul></div></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_unsafe(value)</code></p>
<p>和 <code>set</code> 类似，但是这个方法不会检查 <code>value</code> 的正确性，减少了一些 <code>assert</code> 检查语句的开销，性能会比 <code>set</code> 更好一些。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_cached(value)</code></p>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Single</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Double / Multi</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>和 <code>set</code> 一样都用于赋值信号，但是在赋值的时候会将当前的信号值加入到缓存中，如果下次赋值的时候发现当前的信号值没有变化，那么就不会赋值，这样可以减少一些不必要的信号赋值。</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>暂不支持 Cached 赋值方式。</p></div></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_str(str)</code></p>
<div id="chdl-set_str"></div>
<p>一个通用的字符串赋值方式，可以接收一个 Lua string 类型的字符串，具体的字符串类型由 <code>str</code> 的前两位来区分，例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- set hex string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;0x123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- set binary string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;0b01011&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- set decimal string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><code>0x</code> 表示为 Hex String，<code>0b</code> 表示为 Binary String，其他的字符串则表示为 Decimal String。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_hex_str(str)</code></p>
<div id="chdl-set_hex_str"></div>
<p>使用 Hex String 赋值，<code>str</code> 是一个 Lua string 类型的字符串。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set_hex_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">posedge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_bin_str(value)</code></p>
<p>使用 Binary String 赋值，<code>value</code> 是一个 Lua string 类型的字符串。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set_bin_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;1010&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">posedge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0xA</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_dec_str(value)</code></p>
<p>使用 Decimal String 赋值，<code>value</code> 是一个 Lua string 类型的字符串。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set_dec_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;12&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">posedge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_shuffled()</code></p>
<p>对当前信号进行<strong>随机赋值</strong>，这在验证中很常用。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_bitfield(s, e, v)</code></p>
<p>设置信号的值 <code>v</code>，并且只在 <code>s</code> 到 <code>e</code> 之间的位宽上赋值。<code>v</code> 可以是 Lua number 类型的数值，也可以是一个 <code>uint64_t</code> 类型的 <code>cdata</code>。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set_bitfield</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_bitfield_hex_str(s, e, hex_str)</code></p>
<p>设置信号的值，并且只在 <code>s</code> 到 <code>e</code> 之间的位宽上赋值。<code>hex_str</code> 是一个 Hex String 类型的字符串.</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set_bitfield_hex_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_force(value)</code></p>
<p>强制赋值（与 <code>set_release</code> 配合使用），与 SystemVerilog 中的 <code>force</code> 关键字相同。除了 <code>force</code> 这个属性上的区别之外，其他和 <code>set</code> 一样。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set_force</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set_release</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_release()</code></p>
<p>释放赋值（与 <code>set_force</code> 配合使用），与 SystemVerilog 中的 <code>release</code> 关键字相同。对于使用了 <code>set_force</code> 的信号，需要使用 <code>set_release</code> 来释放赋值，否则会导致信号的值不会更新。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_imm(value)</code></p>
<p>立即赋值版本的 <code>set</code>，除了立即赋值的属性之外，其他和 <code>set</code> 一样。</p>
<div id="set_and_set_imm"></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>立即赋值和普通赋值的区别</div><div class="admonitionContent_BuS1"><p><code>set</code> 方法进行赋值会在下一个时钟边沿到来后才会赋值（更接近 RTL 代码的行为，类似 Verilog 中的非阻塞赋值），而立即赋值则会立即赋值，且立即生效。</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> clock </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- assume that the initial value is 0x00</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x00</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">posedge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- available right after the clock edge</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set_imm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- available right now</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">posedge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_imm_unsafe(value)</code></p>
<p>立即赋值版本的 <code>set_unsafe</code>，除了立即赋值的属性之外，其他和 <code>set_unsafe</code> 一样。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_imm_cached(value)</code></p>
<p>立即赋值版本的 <code>set_cached</code>，除了立即赋值的属性之外，其他和 <code>set_cached</code> 一样。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_imm_str(value)</code></p>
<p>立即赋值版本的 <code>set_str</code>，除了立即赋值的属性之外，其他和 <code>set_str</code> 一样。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_imm_hex_str(value)</code></p>
<p>立即赋值版本的 <code>set_hex_str</code>，除了立即赋值的属性之外，其他和 <code>set_hex_str</code> 一样。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_imm_bin_str(value)</code></p>
<p>立即赋值版本的 <code>set_bin_str</code>，除了立即赋值的属性之外，其他和 <code>set_bin_str</code> 一样。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_imm_dec_str(value)</code></p>
<p>立即赋值版本的 <code>set_dec_str</code>，除了立即赋值的属性之外，其他和 <code>set_dec_str</code> 一样。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_imm_shuffled()</code></p>
<p>立即赋值版本的 <code>set_shuffled</code>，除了立即赋值的属性之外，其他和 <code>set_shuffled</code> 一样。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_imm_bitfield(s, e, v)</code></p>
<p>立即赋值版本的 <code>set_bitfield</code>，除了立即赋值的属性之外，其他和 <code>set_bitfield</code> 一样。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_imm_bitfield_hex_str(s, e, hex_str)</code></p>
<p>立即赋值版本的 <code>set_bitfield_hex_str</code>，除了立即赋值的属性之外，其他和 <code>set_bitfield_hex_str</code> 一样。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_imm_force(value)</code></p>
<p>立即赋值版本的 <code>set_force</code>，除了立即赋值的属性之外，其他和 <code>set_force</code> 一样。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_imm_release()</code></p>
<p>立即赋值版本的 <code>set_release</code>，除了立即赋值的属性之外，其他和 <code>set_release</code> 一样。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:set_freeze()</code></p>
<p>冻结当前的信号值，在后续的仿真中，该信号的值将保持不变。需要调用 <code>&lt;chdl&gt;:set_release()</code> 来取消冻结。</p>
</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="debug-相关">debug 相关<a href="#debug-相关" class="hash-link" aria-label="Direct link to debug 相关" title="Direct link to debug 相关" translate="no">​</a></h4>
<ol>
<li class="">
<p><code>&lt;chdl&gt;:dump()</code></p>
<div id="chdl-dump"></div>
<p>用于将信号的值（主要是以 Hex String 的形式）输出到控制台，可以用于查看信号的值，打印的内容如下所示：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Terminal</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">tb_top.value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> 0x01</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:dump_str()</code></p>
<div id="chdl-dump_str"></div>
<p>会将原本<code>&lt;chdl&gt;:dump()</code> 的输出的内容作为一个返回值进行返回，因此 <code>&lt;chdl&gt;:dump()</code> 也等价于 <code>print(&lt;chdl&gt;:dump_str())</code>。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:get_width()</code></p>
<p>获得信号的位宽，也可以直接访问<code>&lt;chdl&gt;.width</code> 来获得。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:__len()</code></p>
<p><code>chdl</code> 重载了 Lua 的 metatable 的 <code>__len</code> 方法，可以直接使用 <code>#&lt;chdl&gt;</code> 来获得信号的位宽。下面的三种方式来获得信号位宽是等价的：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">#</span><span class="token plain">signal </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">width </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="验证相关">验证相关<a href="#验证相关" class="hash-link" aria-label="Direct link to 验证相关" title="Direct link to 验证相关" translate="no">​</a></h4>
<ol>
<li class="">
<p><code>&lt;chdl&gt;:expect(value)</code></p>
<p>用于断言信号的值，在验证中很常用，如果信号的值与期望值相等则什么也不会发生，如果不相等则会打印报错信息并停止仿真。错误信息格式如下所示：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Terminal</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">tb_top.value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">expect</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain">, but got </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre></div></div>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Single</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Double</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Multi</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p><code>value</code> 的值是一个 Lua 的 number 类型的值。</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><code>value</code> 的值可以是一个 Lua 的 number 类型的值，也可以是一个 <code>uint64_t</code> 类型的 <code>cdata</code>。例如：</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- Lua number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x123ULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- uint64_t cdata(the `ULL` suffix is for 64 bit in LuaJIT)</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><code>value</code> 的值是一个 Lua 的 table，其大小为当前信号的 beat 数。例如：</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">#</span><span class="token plain">signal </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">128</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">expect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x456</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x111</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x222</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- Lua table</span><br></span></code></pre></div></div></div></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:expect_not(value)</code></p>
<p>和 <code>&lt;chdl&gt;:expect(value)</code> 类似，但是如果信号的值与期望值相等则会打印报错信息并停止仿真。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:expect_hex_str(hex_value_str)</code></p>
<p>比较信号的值是否为指定的 Hex String 值，如果不相等则会打印报错信息并停止仿真。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">expect_hex_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:expect_bin_str(bin_value_str)</code></p>
<p>比较信号的值是否为指定的 Binary String 值，如果不相等则会打印报错信息并停止仿真。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">expect_bin_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;1010&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:expect_dec_str(dec_value_str)</code></p>
<p>比较信号的值是否为指定的 Decimal String 值，如果不相等则会打印报错信息并停止仿真。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">expect_dec_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;12&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:expect_not_hex_str(hex_value_str)</code></p>
<p>和 <code>&lt;chdl&gt;:expect_hex_str(hex_value_str)</code> 的作用相反。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:expect_not_bin_str(bin_value_str)</code></p>
<p>和 <code>&lt;chdl&gt;:expect_bin_str(bin_value_str)</code> 的作用相反。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:expect_not_dec_str(dec_value_str)</code></p>
<p>和 <code>&lt;chdl&gt;:expect_dec_str(dec_value_str)</code> 的作用相反。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:is(value)</code></p>
<p>判断信号的值是否等于某个值，如果等于则返回 <code>true</code>，否则返回 <code>false</code>。</p>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Single</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Double</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Multi</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p><code>value</code> 的值是一个 Lua 的 number 类型的值。</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><code>value</code> 的值可以是一个 Lua 的 number 类型的值，也可以是一个 <code>uint64_t</code> 类型的 <code>cdata</code>。例如：</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">is</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- Lua number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">is</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x123ULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- uint64_t cdata(the `ULL` suffix is for 64 bit in LuaJIT)</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p><code>value</code> 的值是一个 Lua 的 table，其大小为当前信号的 beat 数。例如：</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">#</span><span class="token plain">signal </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">128</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">is</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x456</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x111</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x222</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- Lua table</span><br></span></code></pre></div></div></div></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:is_not(value)</code></p>
<p>和 <code>&lt;chdl&gt;:is(value)</code> 的作用相反。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:is_hex_str(hex_value_str)</code></p>
<p>判断信号的值是否等于某个 Hex String 值，如果等于则返回 <code>true</code>，否则返回 <code>false</code>。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">is_hex_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:is_bin_str(bin_value_str)</code></p>
<p>判断信号的值是否等于某个 Binary String 值，如果等于则返回 <code>true</code>，否则返回 <code>false</code>。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">is_bin_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;1010&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:is_dec_str(dec_value_str)</code></p>
<p>判断信号的值是否等于某个 Decimal String 值，如果等于则返回 <code>true</code>，否则返回 <code>false</code>。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">is_dec_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;12&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="信号回调管理">信号回调管理<a href="#信号回调管理" class="hash-link" aria-label="Direct link to 信号回调管理" title="Direct link to 信号回调管理" translate="no">​</a></h4>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>信号回调管理函数只能作用在信号位宽为 1 的信号上</div></div>
<ol>
<li class="">
<p><code>&lt;chdl&gt;:posedge(times, func)</code></p>
<div id="chdl-posedge"></div>
<p>用于等待信号的<strong>上升沿</strong>到来，<code>times</code> 和 <code>func</code> 是可选的两个参数，<code>times</code> 表示等待的次数，<code>func</code> 表示回调函数。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> clock </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">posedge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- wait for one posedge</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">posedge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- wait for 10 posedges</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">posedge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">-- `func` will be called every time posedge arrives, and the argument `c` is the count of the posedge</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;posedge count =&gt; &quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;chdl&gt;:negedge(times, func)</code></p>
<div id="chdl-negedge"></div>
<p>和 <code>&lt;chdl&gt;:posedge(times, func)</code> 类似，但是在等待信号的<strong>下降沿</strong>到来。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:posedge_until(max_limit, func)</code></p>
<div id="chdl-posedge_until"></div>
<p>在每一个时钟<strong>上升沿</strong>检查 <code>func</code> 是否返回 <code>true</code>，如果是 <code>true</code> 则结束等待上升沿，否则继续等待，直到 <code>max_limit</code> 次上升沿到来。</p>
<p>如果在 <code>max_limit</code> 次上升沿到来后，<code>func</code> 仍未返回 <code>true</code>，则 <code>posedge_until</code> 会返回 <code>false</code>，否则返回 <code>true</code>。</p>
</li>
<li class="">
<p><code>&lt;chdl&gt;:negedge_until(max_limit, func)</code></p>
<div id="chdl-negedge_until"></div>
<p>和 <code>&lt;chdl&gt;:posedge_until(max_limit, func)</code> 类似，但是在等待信号的<strong>下降沿</strong>到来。</p>
</li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="具备自动格式识别的赋值接口">具备自动格式识别的赋值接口<a href="#具备自动格式识别的赋值接口" class="hash-link" aria-label="Direct link to 具备自动格式识别的赋值接口" title="Direct link to 具备自动格式识别的赋值接口" translate="no">​</a></h4>
<p>上述的 API 介绍中可以看到针对信号赋值有许多的函数，有时候用户可能需要一种更灵活的方式来赋值信号，能够根据此时输入的值的格式来调用合适的赋值接口函数，Verilua 通过重载 Lua metatable 的 <code>__newindex</code> 方法来实现了这一点。</p>
<p>调用的格式为：<code>&lt;chdl&gt;.value = &lt;value&gt;</code>，其中 <code>&lt;value&gt;</code> 是一个任意能够表示数值的值，注意到这里等号左边的 <code>.value</code>，这是为了能够触发 <code>__newindex</code> 元方法，因此在调用时需要加上。</p>
<p>目前 <code>&lt;value&gt;</code> 支持的格式包括：</p>
<ul>
<li class="">
<p>Lua number 类型的数值；</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x123</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Lua string 类型的字符串（对于 Hex 和 Binary 需要带上前缀）；</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0x123&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0b01011&quot;</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Lua table（或者叫 list），里面的元素为 number 类型;</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x456</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x789</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>LuaJIT 的 <code>cdata</code>，包括了：<code>uint64_t</code> 和 <code>uint32_t[]</code> ；</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 0x123ULL </span><span class="token comment" style="color:#999988;font-style:italic">-- uint64_t cdata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> vec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ffi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;uint32_t[?]&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- uint32_t[] cdata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x123</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- Notice: the index is 1-based</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x456</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x789</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> vec</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>对于 <code>uint32_t[]</code> 的赋值，需要用户手动使用 ffi 创建，因此建议还是采用 Lua table 的方式</div></div>
</li>
<li class="">
<p>Lua boolean 类型的值；</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">false</span><br></span></code></pre></div></div>
</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>可以在一些性能不敏感的场景下使用这种自动识别格式的赋值方式，例如在一些模块的 UT 测试中，这样可以简化业务代码</div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="具备自动格式识别的比较接口">具备自动格式识别的比较接口<a href="#具备自动格式识别的比较接口" class="hash-link" aria-label="Direct link to 具备自动格式识别的比较接口" title="Direct link to 具备自动格式识别的比较接口" translate="no">​</a></h4>
<p>在实际的验证中，往往需要对信号的值进行比较，来判断信号的值是否符合预期，但是信号的数值表示方式在 <code>chdl</code> 中有多种类型，例如 Lua 的 number、string、table、cdata 等，这些类型的比较方式也是不同的，用户可能需要一种能够根据输入的值的格式来进行数值比较的接口，因此 Verilua 通过重载 Lua metatable 的 <code>__eq</code> 方法来实现了这一点。</p>
<p>调用的格式为：<code>&lt;chdl&gt; == &lt;value_wrapper&gt;(&lt;value&gt;)</code>，其中 <code>&lt;value&gt;</code> 是一个任意能够表示数值的值，为了能够触发 <code>__eq</code> 元方法，需要给 <code>&lt;value&gt;</code> 包上一个 <code>&lt;value_wrapper&gt;</code>。</p>
<p><code>&lt;value_wrapper&gt;</code> 有三种可以选择，都是全局可用的一个全局变量，分别是：</p>
<ul>
<li class=""><code>v</code>：最普通的 <code>&lt;value_wrapper&gt;</code>，只是用来触发 <code>__eq</code> 元方法，不对 <code>&lt;value&gt;</code> 做额外的处理；</li>
<li class=""><code>vv</code>：verbose 版本的 <code>v</code>，在比较信号的值时，如果比较失败，那么会在命令行中打印出 log 信息，便于调试，报错信息如下所示：<!-- -->
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Terminal</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">tb_top</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> expect </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0132</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> but got </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0032</span><br></span></code></pre></div></div>
</li>
<li class=""><code>vs</code>：verbose + stop 版本的 <code>v</code>，在比较信号的值时，如果比较失败，那么会在命令行中打印出 log 信息，同时还会触发 assert 断言报错停止仿真，因此 <code>vs</code> 也等价于 <code>assert(&lt;chdl&gt; == vv(&lt;value&gt;))</code>。</li>
</ul>
<p>目前 <code>&lt;value&gt;</code> 支持的格式包括（以 <code>v</code> 这个 <code>&lt;value_wrapper&gt;</code> 为例）：</p>
<ul>
<li class="">
<p>Lua number 类型的数值；</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">v</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">123</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">v</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Lua string 类型的字符串（对于 Hex 和 Binary 需要带上前缀）；</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">v</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;0x123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">v</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;0b01011&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Lua table（或者叫 list），里面的元素为 number 类型;</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">v</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x456</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x789</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>LuaJIT 的 <code>cdata</code>，包括了：<code>uint64_t</code> 和 <code>uint32_t[]</code>；</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">v</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">0x123ULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- uint64_t cdata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> vec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ffi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;uint32_t[?]&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- uint32_t[] cdata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x456</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- Notice: the index is 1-based</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x789</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">v</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">vec</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>对于 <code>uint32_t[]</code> 的赋值，需要用户手动使用 ffi 创建，因此建议还是采用 Lua table 的方式</div></div>
</li>
<li class="">
<p>Lua boolean 类型的值；</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">v</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">v</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">false</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><a class="" href="/verilua/docs/reference/bitvec"><code>BitVec</code></a> 类型的值；</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">v</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">BitVec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">123</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> correct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">chdl</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">v</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">BitVec</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>可以在一些性能不敏感的场景下使用这种自动识别格式的比较方式，例如在一些模块的 UT 测试中，这样可以简化业务代码</div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="callablehdl-接口array">CallableHDL 接口（Array）<a href="#callablehdl-接口array" class="hash-link" aria-label="Direct link to CallableHDL 接口（Array）" title="Direct link to CallableHDL 接口（Array）" translate="no">​</a></h3>
<p>TODO: 针对 Array 类型的信号，Verilua 的 <code>chdl</code> 由独立的 API 进行赋值。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="bundle">Bundle<a href="#bundle" class="hash-link" aria-label="Direct link to Bundle" title="Direct link to Bundle" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="创建-bundle">创建 Bundle<a href="#创建-bundle" class="hash-link" aria-label="Direct link to 创建 Bundle" title="Direct link to 创建 Bundle" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="使用-class-创建-1">使用 class 创建<a href="#使用-class-创建-1" class="hash-link" aria-label="Direct link to 使用 class 创建" title="Direct link to 使用 class 创建" translate="no">​</a></h4>
<p><code>Bundle</code> 是一个 class，因此可以使用类似 <code>class</code> 的方式创建，例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> Bundle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> require </span><span class="token string" style="color:#e3116c">&quot;LuaBundle&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Bundle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;valid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ready&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;opcode&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- 1. &lt;signals_table&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;some_prefix_&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                       </span><span class="token comment" style="color:#999988;font-style:italic">-- 2. &lt;prefix&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;path.to.hier&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                       </span><span class="token comment" style="color:#999988;font-style:italic">-- 3. &lt;hierachy&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;name of bundle&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                     </span><span class="token comment" style="color:#999988;font-style:italic">-- 4. &lt;name&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                                 </span><span class="token comment" style="color:#999988;font-style:italic">-- 5. &lt;is_decoupled&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">nil</span><span class="token plain">                                   </span><span class="token comment" style="color:#999988;font-style:italic">-- 6. &lt;optional_signals&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><code>Bundle</code> 接收六个参数：</p>
<ol>
<li class="">
<p><code>signals_table</code></p>
<p>这个参数是一个 table，其中包含了所有的信号的名称。</p>
</li>
<li class="">
<p><code>prefix</code></p>
<p>这个参数是一个字符串，其中包含了信号的前缀，如果不存在前缀，那么传入的值可以是 <code>&quot;&quot;</code>。</p>
</li>
<li class="">
<p><code>hierachy</code></p>
<p>这个参数是一个字符串，其中包含了信号的完整 hierarchy，这是一个必需添加的参数。</p>
</li>
<li class="">
<p><code>name</code></p>
<p>这个参数是一个字符串，其中包含了信号的名称，可选参数，如果不存在名称，那么传入的值可以是 <code>nil</code>，此时会将 <code>name</code> 设置为 <code>&quot;Unknown&quot;</code>。</p>
</li>
<li class="">
<p><code>is_decoupled</code></p>
<p>用来表示这个 <code>Bundle</code> 是否是 Decoupled 类型（和 Chisel 中的 <a href="https://www.chisel-lang.org/docs/explanations/interfaces-and-connections#the-standard-ready-valid-interface-readyvalidio--decoupled" target="_blank" rel="noopener noreferrer" class="">Decoupled 定义</a>一致），可选参数，默认为 <code>false</code>，可以传入 <code>nil</code> 来使用默认值。</p>
<p>对于 Decoupled 类型的 <code>Bundle</code>，其中必须要在 <code>signals_table</code> 中包含 <code>valid</code>，而对于 <code>ready</code> 这个信号是可选的。针对 Decoupled 类型的 <code>Bundle</code>，有一个 <code>&lt;bdl&gt;:fire()</code> 的方法，用来判断信号的 <code>valid</code> 是否为 <code>1</code>（如果 <code>ready</code> 存在还会判断是否 <code>ready</code> 也为 1），例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Bundle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;valid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ready&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;opcode&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;some_prefix_&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;path.to.hier&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name of bundle&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> valid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">valid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> ready </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ready</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">fire</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">valid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ready</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>如果 <code>Bundle</code> 被标记为是 Decoupled 的，那么除了 <code>valid</code> 和 <code>ready</code> 之外，其他在 <code>signals_table</code> 中的信号都会被自动添加一个 <code>bits_</code> 的前缀，例如上面的 bdl 会有这些信号：</p>
<div class="language-hl_lines=&quot;3 codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-hl_lines=&quot;3 codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">path.to.hier.some_prefix_valid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path.to.hier.some_prefix_ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path.to.hier.some_prefix_bits_opcode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path.to.hier.some_prefix_bits_data</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>这样设计的目的是为了方便 Chisel 用户使用 Verilua 来创建 Bundle</div></div>
</li>
<li class="">
<p><code>optional_signals</code></p>
<p>用来标记 <code>signals_table</code> 中的信号哪些是可选的，如果一个信号被标记为可选的，那么在构建 <code>Bundle</code> 的时候如果发现这个信号不存在，就会忽略这个信号的报错，否则就会报错。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>推荐使用方括号语法</div><div class="admonitionContent_BuS1"><p>除了通过 <code>optional_signals</code> 参数指定可选信号外，还可以在信号列表中使用方括号 <code>[signal_name]</code> 来标记可选信号（推荐）：</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- 使用 optional_signals 参数（旧方法，仍然有效）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;valid | data | nonexistent&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">bdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tb_top&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    optional_signals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;nonexistent&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 使用方括号语法（推荐）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;valid | data | [nonexistent]&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">bdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tb_top&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div></div></div>
</li>
</ol>
<p>上述代码会将下面的信号加入到 <code>Bundle</code> 中：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">path.to.hier.some_prefix_valid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path.to.hier.some_prefix_ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path.to.hier.some_prefix_bits_opcode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path.to.hier.some_prefix_bits_data</span><br></span></code></pre></div></div>
<p>这里的每一个信号的访问方式如下：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> valid  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">valid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> ready  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> opcode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bits</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">opcode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> data   </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bits</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>这里的每一个信号都是一个 <code>chdl</code></div></div>
<p>对于 Decoupled 类型的 <code>Bundle</code> 除了 <code>valid</code> 和 <code>ready</code> 之外，其他信号的访问需要在 <code>bits</code> 下进行访问。</p>
<p>上面都是 Decoupled 类型的 <code>Bundle</code>，对于不是 Decoupled 类型的 <code>Bundle</code>，这里是另一个例子：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Bundle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;data0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;data1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;data2&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;some_prefix_&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;path.to.hier&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name of bundle&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> data0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> data1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> data2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data2</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="使用-string-literal-创建推荐-1">使用 string literal 创建（推荐）<a href="#使用-string-literal-创建推荐-1" class="hash-link" aria-label="Direct link to 使用 string literal 创建（推荐）" title="Direct link to 使用 string literal 创建（推荐）" translate="no">​</a></h4>
<p>和 <code>CallableHDL</code> 一样，<code>Bundle</code> 也可以使用 string literal 来创建，也就是 SLCP，<a href="#slcp-explain" class="">这里</a> 有介绍 SLCP 的好处，下面是一个例子：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">[[</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | valid</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | opcode</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | data</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">]]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">bdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">hier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;path.to.hier&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prefix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;some_prefix_&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name of bundle&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> is_decoupled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">false</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Lua 的 <code>[[ ]]</code> 用来表示多行的字符串</div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Lua 中如果函数的参数只有一个，且这个参数的类型是 string 或者 table，那么就可以省略圆括号，因此上面的代码可以简化为：<code>local bdl = ([[ | valid | ready | opcode | data ]]):bdl {...}</code></div></div>
<p>上述的代码中，每一个信号需要用 <code>|</code> 分隔开，换行不是必须的，因此下面的做法也是可以的：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;valid | ready | opcode | data&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">bdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;| valid | ready | opcode | data&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">bdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;| valid |      ready | opcode    | data |&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">bdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">[[ valid | ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">| opcode</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">   | data</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">]]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">bdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>使用 SLCP 进行构建的时候，参数用 table 的形式传入（key-value 的形式），因此这些参数名和使用 <code>class</code> 构建的时候的参数名一致。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="bundle-接口">Bundle 接口<a href="#bundle-接口" class="hash-link" aria-label="Direct link to Bundle 接口" title="Direct link to Bundle 接口" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span><code>Bundle</code> 的对于每一个信号的成员变量仍然还是一个 <code>CallableHDL</code></div><div class="admonitionContent_BuS1"><p>如果要访问对应信号的值，和 <code>CallableHDL</code> 一样操作即可，例如：</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;valid | ready | opcode | data&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">bdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">hier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;path.to.hier&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prefix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;some_prefix_&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> is_decoupled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">true</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> valid_value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">valid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> ready_value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ready</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bits</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">opcode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bits</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x456</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div></div></div>
<ol>
<li class="">
<p><code>&lt;bdl&gt;:fire()</code></p>
<p>判断信号的 <code>valid</code> 是否为 <code>1</code>（如果 <code>ready</code> 存在还会判断是否 <code>ready</code> 也为 1），例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;valid | ready | opcode | data&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">bdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">hier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;path.to.hier&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prefix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;some_prefix_&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> is_decoupled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">true</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> valid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">valid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> ready </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ready</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">fire</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">valid</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ready</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>只有 is_decoupled 为 <code>true</code> 的 <code>Bundle</code> 才有这个方法</div></div>
</li>
<li class="">
<p><code>&lt;bdl&gt;:get_all()</code></p>
<p>获得所有的信号，并以 Lua table 的形式返回，例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;opcode | data &quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">bdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">hier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;path.to.hier&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prefix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;some_prefix_&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> is_decoupled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">false</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bdl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> opcode_value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signals</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> data_value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> signals</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>只有 is_decoupled 为 <code>false</code> 的 <code>Bundle</code> 才有这个方法</div></div>
</li>
<li class="">
<p><code>&lt;bdl&gt;:set_all(values_tbl)</code></p>
<p>设置所有的信号，并以 Lua table 的形式返回，例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;opcode | data&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">bdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">hier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;path.to.hier&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prefix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;some_prefix_&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> is_decoupled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">false</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> signals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bdl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set_all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x456</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>只有 is_decoupled 为 <code>false</code> 的 <code>Bundle</code> 才有这个方法</div></div>
</li>
<li class="">
<p><code>&lt;bdl&gt;:dump()</code></p>
<p>将 <code>Bundle</code> 中所有的信号当前的数值输出到控制台，可以用于查看信号的值，打印的内容如下所示：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Terminal</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name of bundle</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> valid: 0x1 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ready: 0x1 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> opcode: 0x123 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> data: 0x456</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;bdl&gt;:dump_str()</code></p>
<p>会将原本<code>&lt;bdl&gt;:dump()</code> 的输出的内容作为一个返回值进行返回，因此 <code>&lt;bdl&gt;:dump()</code> 也等价于 <code>print(&lt;bdl&gt;:dump_str())</code>。</p>
</li>
<li class="">
<p><code>&lt;bdl&gt;:format_dump(format_func)</code></p>
<p>将 <code>Bundle</code> 中的所有信号的当前的数值输出到控制台，可以接收一个可选的 <code>format_func</code>，类型为 <code>fun(chdl, name: string): string</code>， 这个函数会在输出每个信号的值之前被调用，如果用户在 <code>format_func</code> 中返回一个非 <code>nil</code> 的 string，那么就会替换原有的值进行输出，例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;valid | value0 | value1 | other&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">bdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">hier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;path.to.hier&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prefix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;some_prefix_&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> is_decoupled </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name of bundle&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">format_dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chdl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> chdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">width </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">..</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot; is &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">..</span><span class="token plain"> chdl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_hex_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>上述代码的输出结果如下所示：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Terminal</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name of bundle</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> valid: 0x1 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> value0 is 0x1 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> value1 is 0x0 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> other: 0x0</span><br></span></code></pre></div></div>
<p>可以看到，只有 <code>value0</code> 和 <code>value1</code> 被替换了，而 <code>other</code> 没有被替换。</p>
</li>
<li class="">
<p><code>&lt;bdl&gt;:format_dump_str(format_func)</code>
会将原本 <code>&lt;bdl&gt;:format_dump()</code> 的输出的内容作为一个返回值进行返回，因此 <code>&lt;bdl&gt;:format_dump()</code> 也等价于 <code>print(&lt;bdl&gt;:format_dump_str())</code>。</p>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="aliasbundle">AliasBundle<a href="#aliasbundle" class="hash-link" aria-label="Direct link to AliasBundle" title="Direct link to AliasBundle" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="创建-aliasbundle">创建 AliasBundle<a href="#创建-aliasbundle" class="hash-link" aria-label="Direct link to 创建 AliasBundle" title="Direct link to 创建 AliasBundle" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="使用-class-创建-2">使用 class 创建<a href="#使用-class-创建-2" class="hash-link" aria-label="Direct link to 使用 class 创建" title="Direct link to 使用 class 创建" translate="no">​</a></h4>
<p><code>AliasBundle</code> 是一个 class，因此可以使用类似 <code>class</code> 的方式创建，例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> AliasBundle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> require </span><span class="token string" style="color:#e3116c">&quot;LuaAliasBundle&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> abdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">AliasBundle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;origin_signal_name&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token string" style="color:#e3116c">&quot;alias_name&quot;</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;origin_signal_name_1&quot;</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;alias_name_1&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                                            </span><span class="token comment" style="color:#999988;font-style:italic">-- 1. &lt;alias_signal_tbl&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;some_prefix&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                                </span><span class="token comment" style="color:#999988;font-style:italic">-- 2. &lt;prefix&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;path.to.hier&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                               </span><span class="token comment" style="color:#999988;font-style:italic">-- 3. &lt;hierachy&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;name of alias bundle&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                       </span><span class="token comment" style="color:#999988;font-style:italic">-- 4. &lt;name&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">nil</span><span class="token plain">                                           </span><span class="token comment" style="color:#999988;font-style:italic">-- 5. &lt;optional_signals&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><code>AliasBundle</code> 接收五个参数：</p>
<ol>
<li class="">
<p><code>alias_signal_tbl</code></p>
<p>这个参数是一个 table，每一个元素还是一个 table，并且包括两个元素，分别是信号的原始名称和信号想要创建的别名。</p>
</li>
<li class="">
<p><code>prefix</code></p>
<p>这个参数是一个字符串，其中包含了信号的前缀，如果不存在前缀，那么传入的值可以是 <code>&quot;&quot;</code>。</p>
</li>
<li class="">
<p><code>hierachy</code></p>
<p>这个参数是一个字符串，其中包含了信号的完整 hierarchy，这是一个必需添加的参数。</p>
</li>
<li class="">
<p><code>name</code></p>
<p>这个参数是一个字符串，其中包含了信号的名称，可选参数，如果不存在名称，那么传入的值可以是 <code>nil</code>，此时会将 <code>name</code> 设置为 <code>&quot;Unknown&quot;</code>。</p>
</li>
<li class="">
<p><code>optional_signals</code></p>
<p>用来标记 <code>signals_table</code> 中的信号哪些是可选的，如果一个信号被标记为可选的，那么在构建 <code>AliasBundle</code> 的时候如果发现这个信号不存在，就会忽略这个信号的报错，否则就会报错。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>推荐使用方括号语法</div><div class="admonitionContent_BuS1"><p>除了通过 <code>optional_signals</code> 参数指定可选信号外，还可以在信号列表中使用方括号来标记可选信号（推荐）：</p><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- 使用 optional_signals 参数（旧方法，仍然有效）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> abdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">[[</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | origin_signal_0 =&gt; alias_0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | nonexistent =&gt; alias_ne</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">]]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">abdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tb_top&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    optional_signals </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;alias_ne&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 使用方括号语法（推荐）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> abdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">[[</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | origin_signal_0 =&gt; alias_0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | [nonexistent =&gt; alias_ne]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">]]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">abdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tb_top&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- 也可以用于没有别名的信号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> abdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">[[</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | origin_signal_0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | [optional_signal]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">]]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">abdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tb_top&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div></div></div>
</li>
</ol>
<p>上述代码会将下面的信号加入到 <code>AliasBundle</code> 中：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">path.to.hier.some_prefix_origin_signal_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path.to.hier.some_prefix_origin_signal_name_1</span><br></span></code></pre></div></div>
<p>由于 <code>AliasBundle</code> 能够为信号创建别名，因此可以直接<strong>使用这些别名来访问信号</strong>，例如对于上面的这个例子中，可以这样子访问信号：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> abdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">alias_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">abdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">alias_name_1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">123</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="使用-string-literal-创建推荐-2">使用 string literal 创建（推荐）<a href="#使用-string-literal-创建推荐-2" class="hash-link" aria-label="Direct link to 使用 string literal 创建（推荐）" title="Direct link to 使用 string literal 创建（推荐）" translate="no">​</a></h4>
<p>和 <code>Bundle</code> 一样，<code>AliasBundle</code> 也可以使用 string literal 来创建，也就是 SLCP，<a href="#slcp-explain" class="">这里</a> 有介绍 SLCP 的好处，下面是一个例子：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> abdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">[[</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | origin_signal_name =&gt; alias_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | origin_signal_name_1 =&gt; alias_name_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">]]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">abdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">hier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;path.to.hier&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prefix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;some_prefix_&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name of alias bundle&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>可以看到和 <code>Bundle</code> 不一样的地方在于可以使用 <code>=&gt;</code> 来创建别名。实际上并不要求对于每一个信号都要有别名，因此下面这种情况也是允许的：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> abdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">[[</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | origin_signal_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | origin_signal_name_1 =&gt; alias_name_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">]]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">abdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">hier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;path.to.hier&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prefix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;some_prefix_&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name of alias bundle&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>甚至可以都不创建别名，这样就和 <code>Bundle</code> 一样了，因此下面这种情况也是允许的：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> abdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">[[</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | origin_signal_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    | origin_signal_name_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">]]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">abdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">hier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;path.to.hier&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prefix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;some_prefix_&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name of alias bundle&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="aliasbundle-接口">AliasBundle 接口<a href="#aliasbundle-接口" class="hash-link" aria-label="Direct link to AliasBundle 接口" title="Direct link to AliasBundle 接口" translate="no">​</a></h3>
<ol>
<li class="">
<p><code>&lt;abdl&gt;:dump()</code></p>
<p>将 <code>AliasBundle</code> 中所有的信号当前的数值输出到控制台，可以用于查看信号的值，打印的内容如下所示：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Terminal</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name of </span><span class="token builtin class-name">alias</span><span class="token plain"> bundle</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> origin_signal_name -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> alias_name: 0x1 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> origin_signal_name_1 -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> alias_name_1: 0x123</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;abdl&gt;:dump_str()</code></p>
<p>会将原本<code>&lt;abdl&gt;:dump()</code> 的输出的内容作为一个返回值进行返回，因此 <code>&lt;abdl&gt;:dump()</code> 也等价于 <code>print(&lt;abdl&gt;:dump_str())</code>。</p>
</li>
<li class="">
<p><code>&lt;abdl&gt;:format_dump(format_func)</code></p>
<p>将 <code>Bundle</code> 中的所有信号的当前的数值输出到控制台，可以接收一个可选的 <code>format_func</code>，类型为 <code>fun(chdl, name: string, alias_name: string): string</code>， 这个函数会在输出每个信号的值之前被调用，如果用户在 <code>format_func</code> 中返回一个非 <code>nil</code> 的 string，那么就会替换原有的值进行输出，例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> abdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;valid | value0 -&gt; v0 | value1 -&gt; v1 | other -&gt; o&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">abdl</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">hier </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;path.to.hier&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prefix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;some_prefix_&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name of abdl&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">abdl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">format_dump</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">chdl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> alias_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> chdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">width </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">..</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot; is &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">..</span><span class="token plain"> chdl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_hex_str</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">..</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot; with alias name: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">..</span><span class="token plain"> alias_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>上述代码的输出结果如下所示：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Terminal</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">name of abdl</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> valid: 0x1 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> value0 is 0x1 with </span><span class="token builtin class-name">alias</span><span class="token plain"> name: v0 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> value1 is 0x0 with </span><span class="token builtin class-name">alias</span><span class="token plain"> name: v1 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> other -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> o: 0x0</span><br></span></code></pre></div></div>
<p>可以看到，只有 <code>value0</code> 和 <code>value1</code> 被替换了，而 <code>other</code> 没有被替换。</p>
</li>
<li class="">
<p><code>&lt;abdl&gt;:format_dump_str(format_func)</code>
会将原本 <code>&lt;abdl&gt;:format_dump()</code> 的输出的内容作为一个返回值进行返回，因此 <code>&lt;abdl&gt;:format_dump()</code> 也等价于 <code>print(&lt;abdl&gt;:format_dump_str())</code>。</p>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="proxytablehandle">ProxyTableHandle<a href="#proxytablehandle" class="hash-link" aria-label="Direct link to ProxyTableHandle" title="Direct link to ProxyTableHandle" translate="no">​</a></h2>
<p><code>ProxyTableHandle</code> 不需要用户创建，全局有且只有一个 <code>ProxyTableHandle</code> 对象，也就是 <code>dut</code> 这个全局变量。</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span><code>ProxyTableHandle</code> 是一个代理表，其子变量仍然是 <code>&lt;dut&gt;</code></div><div class="admonitionContent_BuS1"><div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">signal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> b </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">signal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ProxyTableHandle&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ProxyTableHandle&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ProxyTableHandle&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div><div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>对于 <code>CallableHDL</code>、<code>Bundle</code>、<code>AliasBundle</code>、<code>ProxyTableHandle</code> 都可以使用 <code>__type</code> 字段来判断其类型</div></div></div></div>
<p>:::</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="proxytablehandle-接口">ProxyTableHandle 接口<a href="#proxytablehandle-接口" class="hash-link" aria-label="Direct link to ProxyTableHandle 接口" title="Direct link to ProxyTableHandle 接口" translate="no">​</a></h3>
<ol>
<li class="">
<p><code>&lt;dut&gt;:get_local_path()</code></p>
<p>获得当前的 hierarchy path，例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dut</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_local_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tb_top&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">-- assume that the top module is `tb_top`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hier</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_local_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tb_top.path.to.hier&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;dut&gt;:set(&lt;value&gt;)</code></p>
<p>设置一个信号的值，<code>&lt;value&gt;</code> 只能是一个 Lua number 类型的值，例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>目前 <code>&lt;dut&gt;:set(&lt;value&gt;)</code> 只能赋值 32 bit 的数据到信号中</div></div>
</li>
<li class="">
<p><code>&lt;dut&gt;:set_imm(&lt;value&gt;)</code></p>
<p>立即赋值版本的 <code>set</code>，除了立即赋值的属性之外，其他和 <code>set</code> 一样。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:set_shuffled(&lt;value&gt;)</code></p>
<p>对信号进行随机赋值，这在验证中很常用。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:set_force(&lt;value&gt;)</code></p>
<p>强制赋值（与 <code>set_release</code> 配合使用），与 SystemVerilog 中的 <code>force</code> 关键字相同。除了 <code>force</code> 这个属性上的区别之外，其他和 <code>set</code> 一样。</p>
<p><code>&lt;value&gt;</code> 只能是一个 Lua number。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:set_release()</code></p>
<p>释放赋值（与 <code>set_force</code> 配合使用），与 SystemVerilog 中的 <code>release</code> 关键字相同。对于使用了 <code>set_force</code> 的信号，需要使用 <code>set_release</code> 来释放赋值，否则会导致信号的值不会更新。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:force_all()</code></p>
<p>使用了 <code>&lt;dut&gt;:force_all()</code> 之后，接下来 <code>dut</code> 的所有赋值操作都会转化为 <code>force</code> 类型的赋值。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:release_all()</code></p>
<p>解除 <code>&lt;dut&gt;:force_all()</code> 的作用。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:force_region(func)</code></p>
<p>在一个区域内（也就是 <code>func</code>）强制赋值，这个区域内的所有赋值操作都会转化为 <code>force</code> 类型的赋值。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dut</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">force_region</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0x456</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;dut&gt;:get()</code></p>
<p>获得一个信号的值，返回的值是一个 Lua 的 number 类型的值，例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x123</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>对于超过 32 bit 的信号，返回的值仍然是 32 bit 的数值。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:get_str(fmt)</code></p>
<p>作用类似 <a href="#chdl-get_str" class=""><code>&lt;chdl&gt;:get_str(fmt)</code></a>。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:get_hex_str()</code></p>
<p>作用类似 <a href="#chdl-get_hex_str" class=""><code>&lt;chdl&gt;:get_hex_str()</code></a>。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:set_str(str)</code></p>
<p>作用类似 <a href="#chdl-set_str" class=""><code>&lt;chdl&gt;:set_str(str)</code></a>。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:set_hex_str(str)</code></p>
<p>作用类似 <a href="#chdl-set_hex_str" class=""><code>&lt;chdl&gt;:set_hex_str(str)</code></a>。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:set_force_str(str)</code></p>
<p><code>force</code> 版本的 <code>&lt;dut&gt;:set_str(str)</code>。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:posedge(times, func)</code></p>
<p>作用类似 <a href="#chdl-posedge" class=""><code>&lt;chdl&gt;:posedge(times, func)</code></a>。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:negedge(times, func)</code></p>
<p>作用类似 <a href="#chdl-negedge" class=""><code>&lt;chdl&gt;:negedge(times, func)</code></a>。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:posedge_until(max_limit, func)</code></p>
<p>作用类似 <a href="#chdl-posedge_until" class=""><code>&lt;chdl&gt;:posedge_until(max_limit, func)</code></a>。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:negedge_until(max_limit, func)</code></p>
<p>作用类似 <a href="#chdl-negedge_until" class=""><code>&lt;chdl&gt;:negedge_until(max_limit, func)</code></a>。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:chdl()</code></p>
<p>基于 <code>dut</code> 当前的 hierarchy path 返回一个 <code>chdl</code>，例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> clock </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- equivalent to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> clock </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;tb_top.path.to.clock&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">chdl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><a href="#dut-flex_create_chdl" class="">这里</a>介绍了有关使用 <code>&lt;dut&gt;:chdl()</code> 创建 <code>chdl</code> 的技巧。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:get_width()</code></p>
<p>获得信号的位宽。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:dump()</code> / <code>&lt;dut&gt;:dump_str()</code></p>
<p>作用类似 <a href="#chdl-dump" class=""><code>&lt;chdl&gt;:dump()</code></a> / <a href="#chdl-dump_str" class=""><code>&lt;chdl&gt;:dump_str()</code></a>。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:expect(value)</code> / <code>&lt;dut&gt;:expect_not(value)</code> / <code>&lt;dut&gt;:expect_hex_str(hex_value_str)</code> / <code>&lt;dut&gt;:expect_bin_str(bin_value_str)</code> / <code>&lt;dut&gt;:expect_dec_str(dec_value_str)</code> / <code>&lt;dut&gt;:expect_not_hex_str(hex_value_str)</code> / <code>&lt;dut&gt;:expect_not_bin_str(bin_value_str)</code> / <code>&lt;dut&gt;:expect_not_dec_str(dec_value_str)</code></p>
<p>作用都和 <code>chdl</code> 的对应方法一样。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:is(value)</code> / <code>&lt;dut&gt;:is_not(value)</code> / <code>&lt;dut&gt;:is_hex_str(hex_value_str)</code> / <code>&lt;dut&gt;:is_bin_str(bin_value_str)</code> / <code>&lt;dut&gt;:is_dec_str(dec_value_str)</code></p>
<p>作用都和 <code>chdl</code> 的对应方法一样。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:with_prefix(prefix_str)</code></p>
<p>基于当前的 hierarchy path 创建一个新的 <code>ProxyTableHandle</code>，并且会对后续的任何信号访问加上 <code>prefix_str</code> 前缀。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> io_in </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">with_prefix</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;io_in_&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">io_in</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_local_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;top.path.to.mod.io_in_value&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">io_in</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_local_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;top.path.to.mod.io_in_data&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>&lt;dut&gt;:auto_bundle(params)</code></p>
<p>创建一个 <code>Bundle</code> 对象，并且会根据 <code>params</code> 的配置进行匹配，从而创建出一个符合特定信号名称规律的 <code>Bundle</code> 对象。</p>
<p><code>params</code> 是一个 table，其中包含了一些可选的配置，具体的可选配置如下：</p>
<ul>
<li class="">
<p><code>startswith</code></p>
<p>匹配以指定字符串开头的信号名称。例如，如果设置 <code>startswith = &quot;axi_&quot;</code>，那么只有以 <code>axi_</code> 开头的信号会被包含在 <code>Bundle</code> 中。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- assume the following signals exist:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.axi_aw_valid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.axi_ar_valid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.axi_w_valid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.axi_r_valid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">auto_bundle</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> startswith </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;axi_&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">axi_aw_valid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CallableHDL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">axi_ar_valid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CallableHDL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">axi_w_valid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CallableHDL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">axi_r_valid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CallableHDL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>endswith</code></p>
<p>匹配以指定字符串结尾的信号名称。例如，如果设置 <code>endswith = &quot;_valid&quot;</code>，那么只有以 <code>_valid</code> 结尾的信号会被包含在 <code>Bundle</code> 中。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- assume the following signals exist:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.axi_aw_valid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.axi_ar_valid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.axi_w_valid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.axi_r_valid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">auto_bundle</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> endswith </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;_valid&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">axi_aw_valid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CallableHDL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">axi_ar_valid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CallableHDL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">axi_w_valid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CallableHDL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">axi_r_valid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CallableHDL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><code>endswith</code> 可以和 <code>startswith</code> 一起使用，例如：<code>startswith = &quot;axi_&quot;, endswith = &quot;_valid&quot;</code>。</p>
</li>
<li class="">
<p><code>matches</code></p>
<p>匹配某个正则表达式。例如，如果设置 <code>matches = &quot;data_[0-9]+&quot;</code>，那么只有符合 <code>data_[0-9]+</code> 正则表达式的信号（如 data_0、data_1 等）会被包含在 <code>Bundle</code> 中。</p>
</li>
<li class="">
<p><code>filter</code></p>
<p>过滤函数，可以根据信号名称和信号宽度来过滤掉不需要的信号。该函数接受两个参数：信号名称和信号宽度，返回 true 表示保留该信号，返回 false 表示过滤掉该信号。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- assume the following signals exist:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.value_0  -- width = 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.value_1  -- width = 32</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.value_2  -- width = 64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.value_3  -- width = 128</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">auto_bundle</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> filter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> width</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> width </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value_0 </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nil</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value_1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CallableHDL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value_2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CallableHDL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value_3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CallableHDL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><code>prefix</code></p>
<p>和 <code>startswith</code> 类似，但是在匹配信号名称时会将 <code>prefix</code> 前缀加到信号名称中。</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">-- assume the following signals exist:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.io_in_value_0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.io_in_value_1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.io_in_value_2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">--      tb_top.path.to.mod.io_in_value_3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> bdl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">auto_bundle</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> prefix </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;io_in_&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value_0</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CallableHDL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value_1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CallableHDL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value_2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CallableHDL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bdl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value_3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__type </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;CallableHDL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
</li>
</ul>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>上面的参数中，如果没有特别说明可以和另外的参数使用，那么就不能合并使用</div></div>
</li>
<li class="">
<p><code>&lt;dut&gt;:__newindex(k, v)</code></p>
<p><code>ProxyTableHandle</code> 实现了 <code>__newindex</code> 这个 Lua 的 metatable 元方法，可以用来设置一个信号的值，例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- equivalent to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">set_imm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>需要注意的是这种方式赋值只能赋值 32 bit 的数值，并且是立即赋值的类型。</p>
</li>
<li class="">
<p><code>&lt;dut&gt;:set_freeze()</code></p>
<p>冻结当前的信号值，在后续的仿真中，该信号的值将保持不变。需要调用 <code>&lt;dut&gt;:set_release()</code> 来取消冻结。</p>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="proxytablehandle-的使用">ProxyTableHandle 的使用<a href="#proxytablehandle-的使用" class="hash-link" aria-label="Direct link to ProxyTableHandle 的使用" title="Direct link to ProxyTableHandle 的使用" translate="no">​</a></h3>
<p>我们可以使用临时的变量来保存一个特定 hierarchy path 的 <code>ProxyTableHandle</code>，这样能够方便我们后续的使用，例如：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> mod </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dut</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> another_mod </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">another_mod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mod</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_local_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tb_top.path.to.mod.value&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">another_mod</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">get_local_path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tb_top.path.to.mode.path.to.another_mod.value&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="eventhandle">EventHandle<a href="#eventhandle" class="hash-link" aria-label="Direct link to EventHandle" title="Direct link to EventHandle" translate="no">​</a></h2>
<p><code>EventHandle</code> 的相关使用介绍已经在 <a class="" href="/verilua/docs/reference/multi_task#task-synchronization">这里</a> 有介绍，这里就不再赘述。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/cyril0124/verilua/tree/master/../docs/reference/data_structure.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/verilua/docs/reference/multi_task"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">多任务系统</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/verilua/docs/reference/bitvec"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">BitVec</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#callablehdl" class="table-of-contents__link toc-highlight">CallableHDL</a><ul><li><a href="#创建-callablehdl" class="table-of-contents__link toc-highlight">创建 CallableHDL</a><ul><li><a href="#使用-dut-创建推荐" class="table-of-contents__link toc-highlight">使用 dut 创建（推荐）</a></li><li><a href="#使用-class-创建" class="table-of-contents__link toc-highlight">使用 class 创建</a></li><li><a href="#使用-string-literal-创建推荐" class="table-of-contents__link toc-highlight">使用 string literal 创建（推荐）</a></li></ul></li><li><a href="#callablehdl-接口" class="table-of-contents__link toc-highlight">CallableHDL 接口</a><ul><li><a href="#信号读取" class="table-of-contents__link toc-highlight">信号读取</a></li><li><a href="#信号赋值" class="table-of-contents__link toc-highlight">信号赋值</a></li><li><a href="#debug-相关" class="table-of-contents__link toc-highlight">debug 相关</a></li><li><a href="#验证相关" class="table-of-contents__link toc-highlight">验证相关</a></li><li><a href="#信号回调管理" class="table-of-contents__link toc-highlight">信号回调管理</a></li><li><a href="#具备自动格式识别的赋值接口" class="table-of-contents__link toc-highlight">具备自动格式识别的赋值接口</a></li><li><a href="#具备自动格式识别的比较接口" class="table-of-contents__link toc-highlight">具备自动格式识别的比较接口</a></li></ul></li><li><a href="#callablehdl-接口array" class="table-of-contents__link toc-highlight">CallableHDL 接口（Array）</a></li></ul></li><li><a href="#bundle" class="table-of-contents__link toc-highlight">Bundle</a><ul><li><a href="#创建-bundle" class="table-of-contents__link toc-highlight">创建 Bundle</a><ul><li><a href="#使用-class-创建-1" class="table-of-contents__link toc-highlight">使用 class 创建</a></li><li><a href="#使用-string-literal-创建推荐-1" class="table-of-contents__link toc-highlight">使用 string literal 创建（推荐）</a></li></ul></li><li><a href="#bundle-接口" class="table-of-contents__link toc-highlight">Bundle 接口</a></li></ul></li><li><a href="#aliasbundle" class="table-of-contents__link toc-highlight">AliasBundle</a><ul><li><a href="#创建-aliasbundle" class="table-of-contents__link toc-highlight">创建 AliasBundle</a><ul><li><a href="#使用-class-创建-2" class="table-of-contents__link toc-highlight">使用 class 创建</a></li><li><a href="#使用-string-literal-创建推荐-2" class="table-of-contents__link toc-highlight">使用 string literal 创建（推荐）</a></li></ul></li><li><a href="#aliasbundle-接口" class="table-of-contents__link toc-highlight">AliasBundle 接口</a></li></ul></li><li><a href="#proxytablehandle" class="table-of-contents__link toc-highlight">ProxyTableHandle</a><ul><li><a href="#proxytablehandle-接口" class="table-of-contents__link toc-highlight">ProxyTableHandle 接口</a></li><li><a href="#proxytablehandle-的使用" class="table-of-contents__link toc-highlight">ProxyTableHandle 的使用</a></li></ul></li><li><a href="#eventhandle" class="table-of-contents__link toc-highlight">EventHandle</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 - 2026 Chuyu Zheng. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>