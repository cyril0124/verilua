"use strict";(globalThis.webpackChunkverilua_docs=globalThis.webpackChunkverilua_docs||[]).push([[533],{8162:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>c,toc:()=>t});const c=JSON.parse('{"id":"reference/symbol_helper","title":"SymbolHelper","description":"SymbolHelper \u662f Verilua \u63d0\u4f9b\u7684\u4e00\u4e2a\u5b9e\u7528\u5de5\u5177\u6a21\u5757\uff0c\u7528\u4e8e\u5728\u8fd0\u884c\u65f6\u83b7\u53d6\u4efb\u610f\u5168\u5c40\u7b26\u53f7\uff08\u51fd\u6570\u3001\u53d8\u91cf\uff09\u7684\u5730\u5740\uff0c\u5e76\u52a8\u6001\u8c03\u7528 C \u51fd\u6570\u3002\u5b83\u4e3b\u8981\u5e94\u7528\u4e8e\u4ee5\u4e0b\u573a\u666f\uff1a","source":"@site/../docs/reference/symbol_helper.mdx","sourceDirName":"reference","slug":"/reference/symbol_helper","permalink":"/verilua/docs/reference/symbol_helper","draft":false,"unlisted":false,"editUrl":"https://github.com/cyril0124/verilua/tree/master/../docs/reference/symbol_helper.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u7279\u6b8a\u73af\u5883\u53d8\u91cf","permalink":"/verilua/docs/reference/special_env_variables"}}');var s=l(4848),r=l(8453);const d={},i="SymbolHelper",o={},t=[{value:"\u521d\u59cb\u5316",id:"\u521d\u59cb\u5316",level:2},{value:"\u51fd\u6570\u53c2\u8003",id:"\u51fd\u6570\u53c2\u8003",level:2},{value:"<code>get_executable_name()</code>",id:"get_executable_name",level:3},{value:"<code>get_self_cmdline()</code>",id:"get_self_cmdline",level:3},{value:"<code>get_global_symbol_addr(symbol_name)</code>",id:"get_global_symbol_addrsymbol_name",level:3},{value:"<code>ffi_cast(type_str, value)</code>",id:"ffi_casttype_str-value",level:3},{value:"<code>try_ffi_cast(func_ptr_str, ffi_func_decl_str, func_name)</code>",id:"try_ffi_castfunc_ptr_str-ffi_func_decl_str-func_name",level:3},{value:"\u4f7f\u7528\u573a\u666f\u793a\u4f8b",id:"\u4f7f\u7528\u573a\u666f\u793a\u4f8b",level:2},{value:"1. \u8c03\u7528\u4efb\u610f C \u51fd\u6570\uff08\u5305\u62ec\u4eff\u771f\u5668\u5185\u90e8\u51fd\u6570\u548c\u81ea\u5b9a\u4e49\u51fd\u6570\uff09",id:"1-\u8c03\u7528\u4efb\u610f-c-\u51fd\u6570\u5305\u62ec\u4eff\u771f\u5668\u5185\u90e8\u51fd\u6570\u548c\u81ea\u5b9a\u4e49\u51fd\u6570",level:3},{value:"\u793a\u4f8b\uff1a\u8c03\u7528\u4eff\u771f\u5668\u5185\u90e8\u51fd\u6570 <code>svSetScope</code> \u548c <code>svGetScopeFromName</code>",id:"\u793a\u4f8b\u8c03\u7528\u4eff\u771f\u5668\u5185\u90e8\u51fd\u6570-svsetscope-\u548c-svgetscopefromname",level:4},{value:"\u793a\u4f8b\uff1a\u8c03\u7528\u81ea\u5b9a\u4e49 C \u51fd\u6570",id:"\u793a\u4f8b\u8c03\u7528\u81ea\u5b9a\u4e49-c-\u51fd\u6570",level:4},{value:"2. \u83b7\u53d6\u5f53\u524d\u53ef\u6267\u884c\u6587\u4ef6\u8def\u5f84",id:"2-\u83b7\u53d6\u5f53\u524d\u53ef\u6267\u884c\u6587\u4ef6\u8def\u5f84",level:3},{value:"3. \u8c03\u8bd5\u65f6\u6253\u5370\u51fd\u6570\u5730\u5740",id:"3-\u8c03\u8bd5\u65f6\u6253\u5370\u51fd\u6570\u5730\u5740",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"symbolhelper",children:"SymbolHelper"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"SymbolHelper"})," \u662f Verilua \u63d0\u4f9b\u7684\u4e00\u4e2a\u5b9e\u7528\u5de5\u5177\u6a21\u5757\uff0c\u7528\u4e8e\u5728\u8fd0\u884c\u65f6\u83b7\u53d6",(0,s.jsx)(n.strong,{children:"\u4efb\u610f\u5168\u5c40\u7b26\u53f7"}),"\uff08\u51fd\u6570\u3001\u53d8\u91cf\uff09\u7684\u5730\u5740\uff0c\u5e76\u52a8\u6001\u8c03\u7528 C \u51fd\u6570\u3002\u5b83\u4e3b\u8981\u5e94\u7528\u4e8e\u4ee5\u4e0b\u573a\u666f\uff1a"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u8c03\u7528\u4efb\u610f C \u51fd\u6570\uff08\u5305\u62ec DPI-C \u5bfc\u51fa\u7684\u51fd\u6570\u3001\u4eff\u771f\u5668\u5185\u90e8\u51fd\u6570\u3001\u7cfb\u7edf\u5e93\u51fd\u6570\u3001\u81ea\u5b9a\u4e49\u51fd\u6570\u7b49\uff09"}),"\n",(0,s.jsx)(n.li,{children:"\u8c03\u8bd5\u6216\u6027\u80fd\u6d4b\u91cf\u65f6\u83b7\u53d6\u7b26\u53f7\u4fe1\u606f"}),"\n",(0,s.jsx)(n.li,{children:"\u52a8\u6001\u7ed1\u5b9a\u672a\u901a\u8fc7 FFI \u58f0\u660e\u7684\u51fd\u6570"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u8be5\u6a21\u5757\u57fa\u4e8e LuaJIT \u7684 FFI \u548c Verilua \u5185\u7f6e\u7684 ",(0,s.jsx)(n.code,{children:"get_symbol_address"})," \u529f\u80fd\u5b9e\u73b0\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"\u521d\u59cb\u5316",children:"\u521d\u59cb\u5316"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"SymbolHelper"})," \u4e0d\u9700\u8981\u663e\u5f0f\u521d\u59cb\u5316\uff0c\u76f4\u63a5 require \u5373\u53ef\u4f7f\u7528\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'local SymbolHelper = require "verilua.utils.SymbolHelper"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u51fd\u6570\u53c2\u8003",children:"\u51fd\u6570\u53c2\u8003"}),"\n",(0,s.jsx)(n.h3,{id:"get_executable_name",children:(0,s.jsx)(n.code,{children:"get_executable_name()"})}),"\n",(0,s.jsx)(n.p,{children:"\u83b7\u53d6\u5f53\u524d\u53ef\u6267\u884c\u6587\u4ef6\u7684\u5b8c\u6574\u8def\u5f84\u3002"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a",(0,s.jsx)(n.code,{children:"string"})," \u8def\u5f84\u5b57\u7b26\u4e32"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u793a\u4f8b"}),"\uff1a","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'local path = SymbolHelper.get_executable_name()\nprint("Executable:", path)\n-- \u53ef\u80fd\u7684\u8f93\u51fa\uff1aExecutable: /home/user/verilua/project/simv\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"get_self_cmdline",children:(0,s.jsx)(n.code,{children:"get_self_cmdline()"})}),"\n",(0,s.jsx)(n.p,{children:"\u83b7\u53d6\u542f\u52a8\u5f53\u524d\u8fdb\u7a0b\u7684\u547d\u4ee4\u884c\u53c2\u6570\uff08\u4ee5\u7a7a\u683c\u5206\u9694\uff09\u3002"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a",(0,s.jsx)(n.code,{children:"string"})," \u547d\u4ee4\u884c\u5b57\u7b26\u4e32"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u793a\u4f8b"}),"\uff1a","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'local cmdline = SymbolHelper.get_self_cmdline()\nprint("Command line:", cmdline)\n-- \u53ef\u80fd\u7684\u8f93\u51fa\uff1aCommand line: ./simv +vcs+initreg+0\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"get_global_symbol_addrsymbol_name",children:(0,s.jsx)(n.code,{children:"get_global_symbol_addr(symbol_name)"})}),"\n",(0,s.jsx)(n.p,{children:"\u83b7\u53d6\u6307\u5b9a\u7b26\u53f7\u5728\u53ef\u6267\u884c\u6587\u4ef6\u6216\u52a8\u6001\u5e93\u4e2d\u7684\u8fd0\u884c\u65f6\u5185\u5b58\u5730\u5740\u3002"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u53c2\u6570"}),"\uff1a","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"symbol_name"})," (",(0,s.jsx)(n.code,{children:"string"}),")\uff1a\u7b26\u53f7\u540d\u79f0\uff08\u51fd\u6570\u540d\u3001\u53d8\u91cf\u540d\u7b49\uff09"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a",(0,s.jsx)(n.code,{children:"integer"})," \u7b26\u53f7\u7684\u5730\u5740\uff0864 \u4f4d\u6574\u6570\uff09\uff0c\u82e5\u7b26\u53f7\u4e0d\u5b58\u5728\u5219\u8fd4\u56de ",(0,s.jsx)(n.code,{children:"0"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u8bf4\u660e"}),"\uff1a\u8be5\u51fd\u6570\u4f1a\u89e3\u6790\u5f53\u524d\u8fdb\u7a0b\u7684 ELF \u7b26\u53f7\u8868\uff0c\u5e76\u8003\u8651 ASLR \u504f\u79fb\uff0c\u8fd4\u56de\u6700\u7ec8\u53ef\u7528\u7684\u5730\u5740\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u793a\u4f8b"}),"\uff1a","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'local addr = SymbolHelper.get_global_symbol_addr("svSetScope")\nif addr ~= 0 then\n    print("svSetScope address: 0x" .. bit.tohex(addr))\nend\n-- \u53ef\u80fd\u7684\u8f93\u51fa\uff1asvSetScope address: 0x7f8d4a2b1c00\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"ffi_casttype_str-value",children:(0,s.jsx)(n.code,{children:"ffi_cast(type_str, value)"})}),"\n",(0,s.jsx)(n.p,{children:"\u5c06\u7ed9\u5b9a\u7684\u503c\uff08\u7b26\u53f7\u540d\u6216\u5730\u5740\uff09\u8f6c\u6362\u4e3a\u6307\u5b9a\u7c7b\u578b\u7684 C \u51fd\u6570\u6307\u9488\u6216\u6570\u636e\u6307\u9488\u3002"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u53c2\u6570"}),"\uff1a","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"type_str"})," (",(0,s.jsx)(n.code,{children:"string"}),")\uff1aFFI \u7c7b\u578b\u63cf\u8ff0\uff0c\u4f8b\u5982 ",(0,s.jsx)(n.code,{children:'"void (*)(void *)"'}),"\u3001",(0,s.jsx)(n.code,{children:'"int (*)(int)"'})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"value"}),"\uff1a\u53ef\u4ee5\u662f\u7b26\u53f7\u540d\u5b57\u7b26\u4e32\u3001\u6574\u6570\u5730\u5740\u6216\u5df2\u5b58\u5728\u7684 ",(0,s.jsx)(n.code,{children:"cdata"})," \u5bf9\u8c61"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a\u5bf9\u5e94\u7c7b\u578b\u7684 ",(0,s.jsx)(n.code,{children:"cdata"})," \u51fd\u6570\u6307\u9488\u6216\u6570\u636e\u6307\u9488"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u6ce8\u610f"}),"\uff1a\u5982\u679c ",(0,s.jsx)(n.code,{children:"value"})," \u662f\u5b57\u7b26\u4e32\uff0c\u5185\u90e8\u4f1a\u81ea\u52a8\u8c03\u7528 ",(0,s.jsx)(n.code,{children:"get_global_symbol_addr"})," \u83b7\u53d6\u5730\u5740\uff0c\u5982\u679c\u5730\u5740\u4e3a 0 \u5219\u4f1a\u89e6\u53d1\u65ad\u8a00\u9519\u8bef\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u793a\u4f8b"}),"\uff1a","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'-- \u901a\u8fc7\u7b26\u53f7\u540d\u83b7\u53d6\u51fd\u6570\u6307\u9488\nlocal svSetScope = SymbolHelper.ffi_cast("void *(*)(void *)", "svSetScope")\nlocal scope = svSetScope(some_scope_handle)\n\n-- \u901a\u8fc7\u5730\u5740\u8f6c\u6362\nlocal addr = SymbolHelper.get_global_symbol_addr("my_function")\nlocal my_func = SymbolHelper.ffi_cast("int (*)(int)", addr)\nprint(my_func(42))\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"try_ffi_castfunc_ptr_str-ffi_func_decl_str-func_name",children:(0,s.jsx)(n.code,{children:"try_ffi_cast(func_ptr_str, ffi_func_decl_str, func_name)"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5c1d\u8bd5\u83b7\u53d6\u51fd\u6570\u6307\u9488\uff0c\u5982\u679c\u7b26\u53f7\u5b58\u5728\u5219\u901a\u8fc7 ",(0,s.jsx)(n.code,{children:"ffi_cast"})," \u8f6c\u6362\uff0c\u5426\u5219\u56de\u9000\u5230 FFI \u58f0\u660e\u3002\u8fd9\u662f\u8c03\u7528\u4efb\u610f C \u51fd\u6570\u6700\u5b89\u5168\u7684\u65b9\u5f0f\u3002"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u53c2\u6570"}),"\uff1a","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"func_ptr_str"})," (",(0,s.jsx)(n.code,{children:"string"}),")\uff1a\u51fd\u6570\u6307\u9488\u7c7b\u578b\u63cf\u8ff0\uff0c\u4f8b\u5982 ",(0,s.jsx)(n.code,{children:'"bool (*)()"'})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ffi_func_decl_str"})," (",(0,s.jsx)(n.code,{children:"string"}),")\uff1a\u5b8c\u6574\u7684 FFI \u58f0\u660e\u5b57\u7b26\u4e32\uff0c\u4f8b\u5982 ",(0,s.jsx)(n.code,{children:'"bool my_func();"'})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"func_name"})," (",(0,s.jsx)(n.code,{children:"string"}),")\uff1a\u51fd\u6570\u540d\u79f0"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a",(0,s.jsx)(n.code,{children:"function"})," \u53ef\u8c03\u7528\u7684 Lua \u51fd\u6570"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u8bf4\u660e"}),"\uff1a\u9996\u5148\u5c1d\u8bd5\u5728\u5168\u5c40\u7b26\u53f7\u8868\u4e2d\u67e5\u627e ",(0,s.jsx)(n.code,{children:"func_name"}),"\uff0c\u5982\u679c\u627e\u5230\u5219\u7528 ",(0,s.jsx)(n.code,{children:"ffi_cast"})," \u8f6c\u6362\uff1b\u5982\u679c\u672a\u627e\u5230\uff0c\u5219\u6267\u884c ",(0,s.jsx)(n.code,{children:"ffi.cdef(ffi_func_decl_str)"})," \u5e76\u8fd4\u56de ",(0,s.jsx)(n.code,{children:"ffi.C[func_name]"}),"\uff08\u5982\u679c\u5b58\u5728\uff09\u3002\u5982\u679c\u4e24\u79cd\u65b9\u5f0f\u90fd\u5931\u8d25\uff0c\u4f1a\u89e6\u53d1\u9519\u8bef\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u793a\u4f8b"}),"\uff1a","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'-- \u5c1d\u8bd5\u83b7\u53d6 svSetScope\uff0c\u5982\u679c\u7b26\u53f7\u4e0d\u5b58\u5728\u5219\u4f7f\u7528 FFI \u58f0\u660e\nlocal svSetScope = SymbolHelper.try_ffi_cast(\n    "void *(*)(void *)",\n    "void *svSetScope(void *scope);",\n    "svSetScope"\n)\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u4f7f\u7528\u573a\u666f\u793a\u4f8b",children:"\u4f7f\u7528\u573a\u666f\u793a\u4f8b"}),"\n",(0,s.jsx)(n.h3,{id:"1-\u8c03\u7528\u4efb\u610f-c-\u51fd\u6570\u5305\u62ec\u4eff\u771f\u5668\u5185\u90e8\u51fd\u6570\u548c\u81ea\u5b9a\u4e49\u51fd\u6570",children:"1. \u8c03\u7528\u4efb\u610f C \u51fd\u6570\uff08\u5305\u62ec\u4eff\u771f\u5668\u5185\u90e8\u51fd\u6570\u548c\u81ea\u5b9a\u4e49\u51fd\u6570\uff09"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"SymbolHelper"})," \u53ef\u4ee5\u83b7\u53d6\u5e76\u8c03\u7528\u4efb\u4f55\u5168\u5c40\u53ef\u89c1\u7684 C \u51fd\u6570\uff0c\u65e0\u8bba\u662f\u4eff\u771f\u5668\u63d0\u4f9b\u7684\u5185\u90e8\u51fd\u6570\uff08\u5982 ",(0,s.jsx)(n.code,{children:"svSetScope"}),"\uff09\u3001DPIC \u5bfc\u51fa\u7684\u51fd\u6570\uff0c\u8fd8\u662f\u60a8\u81ea\u5df1\u7f16\u5199\u7684 C \u51fd\u6570\u3002"]}),"\n",(0,s.jsxs)(n.h4,{id:"\u793a\u4f8b\u8c03\u7528\u4eff\u771f\u5668\u5185\u90e8\u51fd\u6570-svsetscope-\u548c-svgetscopefromname",children:["\u793a\u4f8b\uff1a\u8c03\u7528\u4eff\u771f\u5668\u5185\u90e8\u51fd\u6570 ",(0,s.jsx)(n.code,{children:"svSetScope"})," \u548c ",(0,s.jsx)(n.code,{children:"svGetScopeFromName"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'local SymbolHelper = require "verilua.utils.SymbolHelper"\n\n-- \u7ed1\u5b9a svSetScope \u548c svGetScopeFromName\nlocal svSetScope = SymbolHelper.try_ffi_cast(\n    "void *(*)(void *)",\n    "void *svSetScope(void *scope);",\n    "svSetScope"\n)\nlocal svGetScopeFromName = SymbolHelper.try_ffi_cast(\n    "void *(*)(const char *)",\n    "void *svGetScopeFromName(const char *name);",\n    "svGetScopeFromName"\n)\n\n-- \u4f7f\u7528\nlocal scope = svGetScopeFromName("tb_top")\nsvSetScope(scope)\n'})}),"\n",(0,s.jsx)(n.h4,{id:"\u793a\u4f8b\u8c03\u7528\u81ea\u5b9a\u4e49-c-\u51fd\u6570",children:"\u793a\u4f8b\uff1a\u8c03\u7528\u81ea\u5b9a\u4e49 C \u51fd\u6570"}),"\n",(0,s.jsxs)(n.p,{children:["\u5047\u8bbe\u60a8\u5728 ",(0,s.jsx)(n.code,{children:"dpic.cpp"})," \u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a\u51fd\u6570\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:'#include <iostream>\nextern "C" void hello_from_c(const char* name) {\n    std::cout << "Hello, " << name << " from C!" << std::endl;\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u7f16\u8bd1\u540e\uff0c\u5728 Lua \u4e2d\u901a\u8fc7 ",(0,s.jsx)(n.code,{children:"SymbolHelper"})," \u8c03\u7528\u5b83\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'local SymbolHelper = require "verilua.utils.SymbolHelper"\n\n-- \u65b9\u5f0f1\uff1a\u76f4\u63a5 ffi_cast\uff08\u7b26\u53f7\u5fc5\u987b\u5b58\u5728\uff09\nlocal hello = SymbolHelper.ffi_cast("void (*)(const char*)", "hello_from_c")\nhello("Verilua")\n\n-- \u65b9\u5f0f2\uff1a\u4f7f\u7528 try_ffi_cast \u66f4\u5b89\u5168\nlocal hello_safe = SymbolHelper.try_ffi_cast(\n    "void (*)(const char*)",\n    "void hello_from_c(const char* name);",\n    "hello_from_c"\n)\nhello_safe("World")\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-\u83b7\u53d6\u5f53\u524d\u53ef\u6267\u884c\u6587\u4ef6\u8def\u5f84",children:"2. \u83b7\u53d6\u5f53\u524d\u53ef\u6267\u884c\u6587\u4ef6\u8def\u5f84"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'local exe = SymbolHelper.get_executable_name()\nprint("Running from:", exe)\n-- \u53ef\u80fd\u7684\u8f93\u51fa\uff1aRunning from: /home/user/verilua/project/simv\n'})}),"\n",(0,s.jsx)(n.h3,{id:"3-\u8c03\u8bd5\u65f6\u6253\u5370\u51fd\u6570\u5730\u5740",children:"3. \u8c03\u8bd5\u65f6\u6253\u5370\u51fd\u6570\u5730\u5740"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-lua",children:'local addr = SymbolHelper.get_global_symbol_addr("vpi_control")\nif addr ~= 0 then\n    print("vpi_control @ 0x" .. bit.tohex(addr))\nend\n-- \u53ef\u80fd\u7684\u8f93\u51fa\uff1avpi_control @ 0x7f8d4a2b1c00\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u7b26\u53f7\u53ef\u89c1\u6027"}),"\uff1a\u67d0\u4e9b\u7b26\u53f7\u53ef\u80fd\u88ab\u7f16\u8bd1\u5668\u4f18\u5316\u6389\uff08\u4f8b\u5982\u672a\u4f7f\u7528\u7684\u9759\u6001\u51fd\u6570\uff09\uff0c\u6216\u8005\u88ab\u94fe\u63a5\u5668\u9690\u85cf\u3002\u4e3a\u786e\u4fdd\u7b26\u53f7\u53ef\u88ab\u627e\u5230\uff0c\u7f16\u8bd1\u65f6\u9700\u8981\u4fdd\u7559\u7b26\u53f7\uff08\u5982\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"-rdynamic"})," \u6216 ",(0,s.jsx)(n.code,{children:"-Wl,--export-dynamic"}),"\uff09\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u6027\u80fd"}),"\uff1a",(0,s.jsx)(n.code,{children:"get_global_symbol_addr"})," \u9996\u6b21\u8c03\u7528\u65f6\u4f1a\u89e3\u6790 ELF \u6587\u4ef6\u5e76\u7f13\u5b58\u7ed3\u679c\uff0c\u540e\u7eed\u8c03\u7528\u6781\u5feb\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u7ebf\u7a0b\u5b89\u5168"}),"\uff1a\u8be5\u6a21\u5757\u5185\u90e8\u4f7f\u7528\u4e92\u65a5\u9501\u4fdd\u62a4\u7f13\u5b58\uff0c\u53ef\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e2d\u5b89\u5168\u4f7f\u7528\uff08\u4f46 Verilua \u4eff\u771f\u901a\u5e38\u662f\u5355\u7ebf\u7a0b\uff09\u3002"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\u9519\u8bef\u5904\u7406"}),"\uff1a",(0,s.jsx)(n.code,{children:"ffi_cast"})," \u5728\u7b26\u53f7\u4e0d\u5b58\u5728\u65f6\u4f1a\u89e6\u53d1\u9519\u8bef\uff0c\u5efa\u8bae\u5728\u4e0d\u786e\u5b9a\u65f6\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"try_ffi_cast"}),"\u3002"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,n,l)=>{l.d(n,{R:()=>d,x:()=>i});var c=l(6540);const s={},r=c.createContext(s);function d(e){const n=c.useContext(r);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),c.createElement(r.Provider,{value:n},e.children)}}}]);